<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music</title>
    <style>
        /* General Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            color: #0a84ff;
        }

        /* Navigation */
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #fff;
            border-bottom: 1px solid #ddd;
        }

        nav .logo {
            font-size: 1.5em;
            font-weight: bold;
        }

        nav .os-version {
            font-size: 1em;
            color: #666;
        }

        /* Artist List */
        .artist-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            padding: 20px 0;
        }

        .artist-item {
            width: 150px;
            text-align: center;
            cursor: pointer;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .artist-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }


        .artist-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        /* Artist Detail */
        .artist-detail {
            display: none;
            /* Hidden by default */
        }

        .artist-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .artist-header video {
            width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }

        .artist-info h2 {
            margin: 0;
            color: #0a84ff;
        }

        .artist-albums {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .album-item {
            width: 120px;
            /* Smaller album items */
            text-align: center;
            cursor: pointer;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .album-item:hover {
            transform: translateY(-3px);
            /* Slightly less lift */
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .album-item img {
            width: 100%;
            height: 120px;
            /* Square images */
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 5px;
            /* Less margin */
        }

        .album-item p {
            margin: 0;
            font-size: 0.9em;
            /* Smaller font */
        }


        /* Album Detail */
        .album-detail {
            display: none;
        }

        .song-list {
            list-style: none;
            padding: 0;
        }

        .song-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .song-item:last-child {
            border-bottom: none;
        }

        .song-item:hover {
            background-color: #f9f9f9;
        }

        .song-item img {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            margin-right: 10px;
        }

        /* Player (PIP) */
        .player-pip {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: none;
            /* Initially hidden */
            z-index: 1000;
        }

        .player-pip.active {
            display: block;
        }


        .player-pip-content {
            display: flex;
            align-items: center;
            padding: 10px;
        }

        .player-pip img {
            width: 80px;
            height: 80px;
            border-radius: 5px;
            margin-right: 10px;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-controls button {
            background-color: #0a84ff;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .player-controls button:hover {
            background-color: #0768c7;
        }

        /* Full Player */
        .full-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .full-player.active {
            display: flex;
        }

        .full-player-content {
            text-align: center;
            position: relative;
            /* For positioning close button */
        }

        .full-player-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
            z-index: 1003;
            /* Above other content */
        }

        .full-player img {
            max-width: 80%;
            max-height: 60vh;
            border-radius: 10px;
            margin-bottom: 20px;
            /* Space for lyrics */
        }

        .lyrics-container {
            color: #fff;
            font-size: 1.2em;
            max-height: 20vh;
            /* Limit lyrics height */
            overflow-y: auto;
            /* Scrollable lyrics */
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            /* Semi-transparent background */
        }


        .lyrics-line {
            margin-bottom: 0.5em;
            /* Space between lines */
            opacity: 0.6;
            /* Dimmed out by default */
            transition: opacity 0.3s;
            /* Smooth transition */
        }

        .lyrics-line.active {
            opacity: 1;
            /* Fully visible */
            font-weight: bold;
            /* Highlight current line */
        }

        .play-button {
            background-color: #0a84ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .play-button:hover {
            background-color: #0768c7;
        }

        .play-button .icon {
            font-size: 24px;
            /* Icon size */
        }
    </style>
</head>

<body>
    <nav>
        <div class="logo">Siri Music</div>
        <div class="os-version">musicOS 1.0</div>
    </nav>

    <div class="container">
        <h1>Featured Artists</h1>
        <div class="artist-list">
            <!-- Artist items will be dynamically added here -->
        </div>

        <div class="artist-detail">
            <div class="artist-header">
                <video controls autoplay loop muted></video>
                <div class="artist-info">
                    <h2></h2>
                    <button class="play-button" onclick="playFirstSong()">
                        <span class="icon">▶</span>
                        <!-- Play icon -->
                        Play All
                    </button>
                </div>
            </div>
            <h3>Albums</h3>
            <div class="artist-albums">
                <!-- Album items will be dynamically added here -->
            </div>
        </div>

        <div class="album-detail">
            <h2></h2>
            <ul class="song-list">
                <!-- Song items will be dynamically added here -->
            </ul>
        </div>
    </div>

    <!-- Player (PIP) -->
    <div class="player-pip">
        <div class="player-pip-content">
            <img src="" alt="Album Art">
            <div class="player-controls">
                <button onclick="togglePlayPause()">
                    <span id="playPauseIcon">▶</span><!-- Play/Pause icon -->
                </button>
            </div>
        </div>
        <audio id="audioPlayer" ontimeupdate="updateProgress()"></audio>
    </div>

    <!-- Full Player -->
    <div class="full-player">

        <div class="full-player-content">
            <span class="full-player-close" onclick="closeFullPlayer()">×</span>
            <img src="" alt="Album Art">
            <div class="lyrics-container">
                <!-- Lyrics will be displayed here -->
            </div>
        </div>
    </div>


    <script>
        // Data (replace with your actual data)
        const artistsData = {
            "NewJeans": {
                name: "NewJeans",
                photo: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg",
                video: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.mp4",
                albums: {
                    "NewJeans2ndEP'GetUp'": {
                        name: "NewJeans 2nd EP 'Get Up'",
                        cover: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg",
                        songs: {
                            "ETA": {
                                title: "ETA",
                                file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
                                lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt"
                            }
                        }
                    }
                }

            }
        };

        let currentAudio = null;
        let currentLyrics = null;
        let currentLyricIndex = 0;
        let isPlaying = false;


        // --- DOM Element References ---
        const artistListEl = document.querySelector('.artist-list');
        const artistDetailEl = document.querySelector('.artist-detail');
        const artistVideoEl = document.querySelector('.artist-detail video');
        const artistNameEl = document.querySelector('.artist-info h2');
        const artistAlbumsEl = document.querySelector('.artist-albums');
        const albumDetailEl = document.querySelector('.album-detail');
        const albumNameEl = document.querySelector('.album-detail h2');
        const songListEl = document.querySelector('.song-list');

        const playerPipEl = document.querySelector('.player-pip');
        const pipAlbumArtEl = document.querySelector('.player-pip img');
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseIcon = document.getElementById('playPauseIcon');

        const fullPlayerEl = document.querySelector('.full-player');
        const fullPlayerAlbumArtEl = document.querySelector('.full-player img');
        const lyricsContainerEl = document.querySelector('.lyrics-container');


        // --- Function Definitions ---

        // --- UI Update Functions ---
        // Function to render the list of artists
        function renderArtistList() {
            for (const artistId in artistsData) {
                const artist = artistsData[artistId];
                const artistItem = document.createElement('div');
                artistItem.classList.add('artist-item');
                artistItem.innerHTML = `
                    <img src="${artist.photo}" alt="${artist.name}">
                    <p>${artist.name}</p>
                `;
                artistItem.addEventListener('click', () => showArtistDetail(artistId));
                artistListEl.appendChild(artistItem);
            }
        }

        function showArtistDetail(artistId) {
            const artist = artistsData[artistId];

            artistVideoEl.src = artist.video;
            artistNameEl.textContent = artist.name;
            artistAlbumsEl.innerHTML = ''; // Clear previous albums

            for (const albumId in artist.albums) {
                const album = artist.albums[albumId];
                const albumItem = document.createElement('div');
                albumItem.classList.add('album-item');
                albumItem.innerHTML = `
                    <img src="${album.cover}" alt="${album.name}">
                    <p>${album.name}</p>
                `;
                albumItem.addEventListener('click', () => showAlbumDetail(artistId, albumId));
                artistAlbumsEl.appendChild(albumItem);
            }

            // Show the artist detail view and hide others
            artistListEl.style.display = 'none';
            artistDetailEl.style.display = 'block';
            albumDetailEl.style.display = 'none';
        }

        function showAlbumDetail(artistId, albumId) {
            const album = artistsData[artistId].albums[albumId];
            albumNameEl.textContent = album.name;
            songListEl.innerHTML = ''; // Clear previous songs


            for (const songId in album.songs) {
                const song = album.songs[songId];
                const songItem = document.createElement('li');
                songItem.classList.add('song-item');
                songItem.innerHTML = `
                    <img src="${album.cover}" alt="${album.name}">
                    <span>${song.title}</span>
                `;
                songItem.addEventListener('click', () => playSong(song.file, album.cover, song.lyrics));
                songListEl.appendChild(songItem);
            }

            //Show album details
            artistListEl.style.display = 'none';
            artistDetailEl.style.display = 'none';
            albumDetailEl.style.display = 'block';
        }


        // --- Player Functions ---

        function playSong(songFile, albumCover, lyricsFile) {
            if (currentAudio) {
                currentAudio.pause(); // Stop currently playing song
            }
            currentAudio = new Audio(songFile);
            currentAudio.play();
            isPlaying = true;
            pipAlbumArtEl.src = albumCover;
            playerPipEl.classList.add('active'); // Show PIP
            playPauseIcon.innerHTML = '❚❚'; // Change to pause icon

            fullPlayerAlbumArtEl.src = albumCover;  // Set full player album art

            currentAudio.onended = () => {
                isPlaying = false;
                playPauseIcon.innerHTML = '▶'; // Change back to play icon
            }

            if (lyricsFile) {
                loadLyrics(lyricsFile);
            } else {
                currentLyrics = null;
                lyricsContainerEl.innerHTML = ''; // Clear lyrics if none
            }
        }

        function togglePlayPause() {
            if (!currentAudio) return;

            if (isPlaying) {
                currentAudio.pause();
                playPauseIcon.innerHTML = '▶'; // Play icon
            } else {
                currentAudio.play();
                playPauseIcon.innerHTML = '❚❚'; // Pause icon
            }
            isPlaying = !isPlaying;
        }

        function updateProgress() {
            if (currentLyrics && currentAudio) {
                const currentTime = currentAudio.currentTime;
                // Find the lyric line to display
                let nextLyricIndex = 0;

                for (let i = 0; i < currentLyrics.length; i++) {
                    if (currentLyrics[i].time <= currentTime) {
                        nextLyricIndex = i;
                    } else {
                        break; // Stop searching once we find a future time
                    }
                }


                if (nextLyricIndex !== currentLyricIndex) {
                    // Update the active lyric line
                    const lyricLines = lyricsContainerEl.querySelectorAll('.lyrics-line');

                    if (lyricLines[currentLyricIndex]) {
                        lyricLines[currentLyricIndex].classList.remove('active');
                    }

                    currentLyricIndex = nextLyricIndex;

                    if (lyricLines[currentLyricIndex]) {
                        lyricLines[currentLyricIndex].classList.add('active');
                    }


                    // Scroll the lyrics container to keep active line in view.
                    const activeLine = lyricLines[currentLyricIndex];
                    if (activeLine) {
                        const containerHeight = lyricsContainerEl.offsetHeight;
                        const lineTop = activeLine.offsetTop;
                        const lineHeight = activeLine.offsetHeight;
                        const scrollOffset = lineTop - (containerHeight / 2) + (lineHeight / 2);

                        lyricsContainerEl.scrollTo({
                            top: scrollOffset,
                            behavior: 'smooth'
                        });
                    }
                }
            }
        }

        function playFirstSong() {
            // Find the first song in the first album and play it
            for (const artistId in artistsData) {
                const artist = artistsData[artistId];
                for (const albumId in artist.albums) {
                    const album = artist.albums[albumId];
                    for (const songId in album.songs) {
                        const song = album.songs[songId];
                        playSong(song.file, album.cover, song.lyrics);
                        return; // Stop after finding the first song
                    }
                }
            }
        }

        // --- Lyrics Functions ---
        async function loadLyrics(lyricsFile) {
            try {
                const response = await fetch(lyricsFile);
                const srtData = await response.text();
                currentLyrics = parseSRT(srtData); // Parse and store lyrics
                renderLyrics(); // Display lyrics
            } catch (error) {
                console.error("Error loading or parsing lyrics:", error);
                currentLyrics = null;
                lyricsContainerEl.innerHTML = '<div class="lyrics-line">Lyrics not available.</div>';
            }
        }

        function renderLyrics() {
            lyricsContainerEl.innerHTML = ''; // Clear existing lyrics

            if (currentLyrics) {
                currentLyrics.forEach((lyric) => {
                    const lyricLine = document.createElement('div');
                    lyricLine.classList.add('lyrics-line');
                    lyricLine.textContent = lyric.text;
                    lyricsContainerEl.appendChild(lyricLine);
                });
            }
            currentLyricIndex = 0;
        }

        // Function to parse SRT data
        function parseSRT(srtData) {
            const lines = srtData.trim().split('\n\n');
            const lyrics = [];

            lines.forEach(line => {
                const parts = line.trim().split('\n');
                if (parts.length >= 3) {
                    const time = parts[1];
                    const text = parts.slice(2).join('<br>');
                    const [start, end] = time.split(' --> ');
                    lyrics.push({
                        time: srtTimeToSeconds(start),
                        text: text
                    });
                }
            });
            return lyrics;
        }


        function srtTimeToSeconds(timeStr) {
            const [hours, minutes, seconds] = timeStr.split(':');
            const [sec, ms] = seconds.split(',');
            return parseInt(hours) * 3600 + parseInt(minutes) * 60 + parseInt(sec) + parseInt(ms) / 1000;
        }


        // --- Event Listeners ---

        // Open full player when PIP album art is clicked
        pipAlbumArtEl.addEventListener('click', () => {
            if (currentAudio) {
                fullPlayerEl.classList.add('active');
            }
        });

        function closeFullPlayer() {
            fullPlayerEl.classList.remove('active');
        }


        // --- Initialization ---
        renderArtistList();

    </script>
</body>

</html>
