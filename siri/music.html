<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music</title>
    <style>
        /* CSS Reset */
        body,
        h1,
        h2,
        h3,
        p,
        ul,
        li {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
            overflow-x: hidden; /* 가로 스크롤 방지 */
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }


        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #ddd;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5em;
            font-weight: 600;
        }

        /* Main */
        .artists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .artist-card {
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
            border-radius: 10px;
            overflow: hidden;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .artist-card:hover {
            transform: scale(1.05);
        }

        .artist-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px 10px 0 0;
        }


        .artist-card p {
            padding: 10px;
            font-weight: bold;
        }

        /* Artist Page */
        .artist-page {
            display: none; /* Initially hide artist pages */
            padding: 20px;
        }

      .artist-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .artist-header video {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .artist-info {
            flex-grow: 1;
        }

        .artist-info h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

      .play-button {
        background-color: #0a84ff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 1em;
        display: inline-flex;
        align-items: center;
        gap: 8px; /* Space between symbol and text */
        transition: background-color 0.3s ease;
      }

       .play-button:hover {
            background-color: #007aff; /* Slightly darker blue on hover */
        }

        /* Album List */
        .album-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .album-item {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .album-item:hover {
            transform: scale(1.03);
        }


        .album-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .album-item p {
            padding: 10px;
            font-weight: 500;
        }

        /* Album Page */
        .album-page {
            display: none; /* Initially hidden */
            padding: 20px;
        }

        .album-page h2 {
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .song-list {
            display: grid;
            gap: 10px;
        }

        .song-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .song-item:hover {
             background-color: rgba(230, 230, 230, 0.8);
        }

        .song-item .song-number {
            margin-right: 15px;
            font-weight: bold;
            color: #0a84ff;
            flex-shrink: 0; /* Prevent number from shrinking */

        }

       .song-item .song-title {
            flex-grow: 1; /* Allow title to take available space */
            overflow: hidden;
            white-space: nowrap; /* Prevent wrapping */
            text-overflow: ellipsis; /* Add ellipsis for long titles */
        }


        /* Player (PIP) */
        .player-pip {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            display: none;
            /* Initially hidden */
            z-index: 1000;
            transition: transform 0.4s ease, width 0.4s ease; /* Added transitions */
        }

        .player-pip.expanded {
            /* Style for expanded player */
            width: 80%;
            max-width: 800px;
            /* Adjust as needed */
            bottom: 5%;
            right: 5%;
            transform: translate(0, 0);
            /* Reset any previous translation */

        }

        .player-pip .album-art {
            width: 100%;
            height: auto; /* Removed fixed height */
            display: block;
        }

        .player-pip.expanded .album-art{
             width: 200px; /* Set explicit width for expanded album art */
            height: 200px;
            float: left;  /* Float the image to the left */
            margin-right: 20px;
            margin-bottom: 20px;
        }


        .player-controls {
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        .player-controls button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            color: #0a84ff;
        }

        .lyrics-container {
            padding: 20px;
            text-align: center;
            max-height: 300px;  /* Increased height for lyrics */
            overflow-y: auto; /* Allow scrolling if lyrics are long */
             display: none;  /* Initially hidden */
        }

        .player-pip.expanded .lyrics-container {
            display: block; /* Show when player is expanded */
             clear: both;  /* Clear the floated album art */
             padding-top: 0px; /* Add some space above the lyrics */

        }

        .current-lyric {
            font-size: 1.2em;
            line-height: 1.5;
            color: #222;  /* Slightly darker color for better visibility */
            transition: all 0.3s ease; /* Smooth transition for lyrics change */
        }

        .back-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #0a84ff;
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1001;

        }

         /* Progress Bar Styles */
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #ddd;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 10px;
            position: relative; /* For the buffer bar */
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background-color: #0a84ff;
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .progress-buffer {
              position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0;
            background-color: rgba(0, 122, 255, 0.3); /* Semi-transparent blue */
            border-radius: 4px;
            z-index: -1; /* Place it behind the progress bar */

        }


    </style>
</head>

<body>

    <div class="header">
        <h1>Siri Music</h1>
        <span>musicOS 1.0</span>
    </div>


    <div class="container artists-grid">
        <!-- Artist cards will be added here -->
    </div>

    <!-- Artist Page (Initially Hidden) -->
    <div class="artist-page container">
        <button class="back-button" onclick="goBack()">← Back</button>
        <div class="artist-header">
            <video id="artist-video" src="" autoplay loop muted playsinline></video>
            <div class="artist-info">
                <h2 id="artist-name"></h2>
                <button class="play-button" onclick="playArtist()"><span class="symbol">▶</span> Play</button>
            </div>

        </div>
        <h3>Albums</h3>
        <div class="album-list">
            <!-- Album items will be added here -->
        </div>
    </div>

    <!-- Album Page (Initially Hidden) -->
    <div class="album-page container">
        <button class="back-button" onclick="goBack()">← Back</button>
        <h2 id="album-title"></h2>
        <div class="song-list">
            <!-- Song items be added here -->
        </div>
    </div>

    <!-- Player (PIP) -->
    <div class="player-pip">
         <img class="album-art" src="" alt="Album Art">
        <div class="progress-bar-container">
            <div class="progress-buffer"></div>
            <div class="progress-bar"></div>
        </div>

        <div class="player-controls">
            <button onclick="previousSong()">◀◀</button>
            <button id="play-pause" onclick="togglePlay()">▶</button>
            <button onclick="nextSong()">▶▶</button>
        </div>
        <div class="lyrics-container">
            <p class="current-lyric"></p>
        </div>
        <audio id="audio-player" preload="metadata"></audio>
    </div>


    <script>
        let currentSongIndex = 0;
        let currentAlbum = null;
        let currentArtist = null;
        let lyrics = [];
        let isPlaying = false;
        let currentView = 'home'; // Keep track of current view: home, artist, album
        let previousViews = [];   // Stack to store previous views for back button


        const audioPlayer = document.getElementById('audio-player');
        const playPauseButton = document.getElementById('play-pause');
        const progressBar = document.querySelector('.progress-bar');
        const progressBuffer = document.querySelector('.progress-buffer');
        const progressBarContainer = document.querySelector('.progress-bar-container');
        const lyricsContainer = document.querySelector('.lyrics-container');
        const currentLyricDisplay = document.querySelector('.current-lyric');
        const playerPip = document.querySelector('.player-pip');
        const albumArtPip = document.querySelector('.player-pip .album-art');




        const artistsData = {
            "NewJeans": {
                name: "NewJeans",
                photo: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg",
                video: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.mp4",
                albums: {
                    "NewJeans1stEP'NewJeans'": {
                        title: "NewJeans 1st EP 'New Jeans'",
                        cover: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans1stEP'NewJeans'/NewJeans1stEP'NewJeans'.jpg",
                        songs: [
                            { title: "Attention", src: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans1stEP'NewJeans'/Attention.mp3", lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans1stEP'NewJeans'/Attention.srt" },
                            { title: "Hype Boy", src: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans1stEP'NewJeans'/HypeBoy.mp3", lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans1stEP'NewJeans'/HypeBoy.srt" }
                        ]
                    },
                    "NewJeans2ndEP'GetUp'": {
                        title: "NewJeans 2nd EP 'Get Up'",
                        cover: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg",
                        songs: [
                            { title: "ETA", src: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3", lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt" },
                            { title: "Super Shy", src: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.mp3", lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.srt" }
                        ]
                    }
                }
            },
             "IVE": {
                name: "IVE",
                photo: "http://www.applesodam.kro.kr/music/IVE/IVE.jpg",
                video: "http://www.applesodam.kro.kr/music/IVE/IVE.mp4",
                albums: {
                    "IVE1stEP'IMINE'": {
                        title: "IVE 1st EP 'I'VE MINE'",
                        cover: "http://www.applesodam.kro.kr/music/IVE/IVE1stEP'IMINE'/IVE1stEP'IMINE'.jpg",
                        songs: [
                            { title: "Off The Record", src: "http://www.applesodam.kro.kr/music/IVE/IVE1stEP'IMINE'/OffTheRecord.mp3", lyrics: "http://www.applesodam.kro.kr/music/IVE/IVE1stEP'IMINE'/OffTheRecord.srt" },
                            { title: "Baddie", src: "http://www.applesodam.kro.kr/music/IVE/IVE1stEP'IMINE'/Baddie.mp3", lyrics: "http://www.applesodam.kro.kr/music/IVE/IVE1stEP'IMINE'/Baddie.srt" }
                        ]
                    },
                }
            },

        };


        // Function to create artist cards
        function createArtistCards() {
            const artistsGrid = document.querySelector('.artists-grid');
            for (const artistKey in artistsData) {
                const artist = artistsData[artistKey];
                const card = document.createElement('div');
                card.classList.add('artist-card');
                card.innerHTML = `<img src="${artist.photo}" alt="${artist.name}">
                              <p>${artist.name}</p>`;
                card.onclick = () => showArtistPage(artistKey);
                artistsGrid.appendChild(card);
            }
        }


        // Function to show artist page
        function showArtistPage(artistKey) {
             if (currentView !== 'artist') {
                previousViews.push(currentView);
            }
            currentView = 'artist';

            currentArtist = artistKey;
            const artist = artistsData[artistKey];

            // Update the artist header
            document.getElementById('artist-video').src = artist.video;
            document.getElementById('artist-name').textContent = artist.name;

            // Clear any existing album items
            const albumList = document.querySelector('.album-list');
            albumList.innerHTML = '';

            // Create album items
            for (const albumKey in artist.albums) {
                const album = artist.albums[albumKey];
                const albumItem = document.createElement('div');
                albumItem.classList.add('album-item');
                albumItem.innerHTML = `
                <img src="${album.cover}" alt="${album.title}">
                <p>${album.title}</p>
            `;
                albumItem.onclick = () => showAlbumPage(artistKey, albumKey);
                albumList.appendChild(albumItem);
            }

            // Hide the artists grid and show the artist page
            document.querySelector('.artists-grid').style.display = 'none';
            document.querySelector('.artist-page').style.display = 'block';

            // Reset scroll position
            window.scrollTo(0, 0);
        }

          function showAlbumPage(artistKey, albumKey) {
             if (currentView !== 'album') {
                previousViews.push(currentView);
            }
            currentView = 'album';
            currentAlbum = albumKey;

            const artist = artistsData[artistKey];
            const album = artist.albums[albumKey];


            document.getElementById('album-title').textContent = album.title;

            const songList = document.querySelector('.song-list');
        songList.innerHTML = ''; // Clear previous songs

        album.songs.forEach((song, index) => {
            const songItem = document.createElement('div');
            songItem.classList.add('song-item');
            songItem.innerHTML = `<span class="song-number">${index + 1}</span><span class="song-title">${song.title}</span>`;
            songItem.addEventListener('click', () => playSong(artistKey, albumKey, index));
            songList.appendChild(songItem);
        });

              document.querySelector('.artist-page').style.display = 'none';
            document.querySelector('.album-page').style.display = 'block';
             window.scrollTo(0, 0);

        }



       async function playSong(artistKey, albumKey, songIndex) {
            currentArtist = artistKey;
            currentAlbum = albumKey;
            currentSongIndex = songIndex;
            isPlaying = true;

            const album = artistsData[artistKey].albums[albumKey];
            const song = album.songs[songIndex];

            audioPlayer.src = song.src;
            audioPlayer.load(); // Load the new song
            albumArtPip.src = album.cover

            // Get and parse lyrics
            lyrics = await parseLyrics(song.lyrics);


             // Show and update the PIP
            playerPip.style.display = 'block';
            playPauseButton.innerHTML = '❚❚'; // Change to pause icon
            audioPlayer.play();

        }


        function togglePlay() {
            if (currentAlbum === null) {
                // If no song is selected, start playing from the beginning.
                const firstArtistKey = Object.keys(artistsData)[0];
                const firstAlbumKey = Object.keys(artistsData[firstArtistKey].albums)[0];
                playSong(firstArtistKey, firstAlbumKey, 0); // Play the first song
                return;
            }


            if (isPlaying) {
                audioPlayer.pause();
                playPauseButton.innerHTML = '▶'; // Play symbol
            } else {
                audioPlayer.play();
                playPauseButton.innerHTML = '❚❚'; // Pause symbol
            }
            isPlaying = !isPlaying;
        }

        function nextSong() {
            if (!currentAlbum) return;
            currentSongIndex++;
            const album = artistsData[currentArtist].albums[currentAlbum];
            if (currentSongIndex >= album.songs.length) {
                currentSongIndex = 0; // Loop back to the first song
            }
            playSong(currentArtist, currentAlbum, currentSongIndex);
        }

        function previousSong() {
             if (!currentAlbum) return;
            currentSongIndex--;
            const album = artistsData[currentArtist].albums[currentAlbum];
            if (currentSongIndex < 0) {
                currentSongIndex = album.songs.length - 1; // Go to the last song
            }
            playSong(currentArtist, currentAlbum, currentSongIndex);
        }

        function playArtist(){
            const firstAlbumKey = Object.keys(artistsData[currentArtist].albums)[0];
            showAlbumPage(currentArtist, firstAlbumKey);
            playSong(currentArtist, firstAlbumKey, 0);
        }


        async function parseLyrics(srtUrl) {
            try {
                const response = await fetch(srtUrl);
                const srtText = await response.text();
                const parser = new window.SRTParser(); //  SRTParser from the library
                return parser.fromSrt(srtText);

            } catch (error) {
                console.error('Error parsing lyrics:', error);
                return []; // Return an empty array on error
            }
        }


        function updateLyrics(currentTime) {
            if (!lyrics || lyrics.length === 0) {
                 currentLyricDisplay.textContent = '';
                return;
            }

            let currentLyric = '';
            for (const lyric of lyrics) {
                 const startTime = timeToSeconds(lyric.startTime);
                const endTime = timeToSeconds(lyric.endTime);
                if (currentTime >= startTime && currentTime <= endTime) {
                    currentLyric = lyric.text;
                    break;
                }
            }

            currentLyricDisplay.textContent = currentLyric;

        }


        // Utility function to convert SRT time to seconds
        function timeToSeconds(timeString) {
              const [hh, mm, ss_mmm] = timeString.split(':');
            const [ss, mmm] = ss_mmm.split(',');
            return (parseInt(hh) * 3600) + (parseInt(mm) * 60) + parseInt(ss) + (parseInt(mmm) / 1000);
        }


         // Event Listeners for audio player
        audioPlayer.addEventListener('timeupdate', () => {
            const currentTime = audioPlayer.currentTime;
            const duration = audioPlayer.duration;

            if (!isNaN(duration)) {
                const progress = (currentTime / duration) * 100;
                progressBar.style.width = `${progress}%`;
                updateLyrics(currentTime);
            }
        });

        audioPlayer.addEventListener('progress', () => {
            if (audioPlayer.buffered.length > 0 && audioPlayer.duration > 0) {
                 const bufferedEnd = audioPlayer.buffered.end(audioPlayer.buffered.length - 1);
                const bufferedPercent = (bufferedEnd / audioPlayer.duration) * 100;
                progressBuffer.style.width = `${bufferedPercent}%`;
            }
        })

        progressBarContainer.addEventListener('click', (e) => {
            const width = progressBarContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;

            audioPlayer.currentTime = (clickX / width) * duration;
        });

        audioPlayer.addEventListener('ended', () => {
            nextSong(); // Play the next song when the current one ends
        });

        playerPip.addEventListener('click', () => {
            playerPip.classList.toggle('expanded');
        })

        function goBack() {
            if (previousViews.length > 0) {
                const lastView = previousViews.pop();
                if (lastView === 'home') {
                    showHomePage();
                } else if (lastView === 'artist') {
                    showArtistPage(currentArtist); //  currentArtist is still available
                }
            }
        }

        function showHomePage() {
            currentView = 'home';
            document.querySelector('.artist-page').style.display = 'none';
            document.querySelector('.album-page').style.display = 'none';
            document.querySelector('.artists-grid').style.display = 'grid';
              window.scrollTo(0, 0);

        }


        // Initialize
        createArtistCards();


    </script>
    <!-- Include the SRT parser library -->
    <script src="https://cdn.jsdelivr.net/npm/srt-parser-2@1.2.3/dist/srt-parser.min.js"></script>

</body>

</html>
