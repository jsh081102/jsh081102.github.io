<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music</title>
    <style>
        /* Reset & 기본 스타일 */
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; background-color: #f0f0f0; color: #000; }
        *, ::before, ::after { box-sizing: border-box; }
        button { background: none; color: inherit; border: none; padding: 0; font: inherit; cursor: pointer; outline: none; }
        ul, ol { list-style: none; padding: 0; margin: 0; }
        a { text-decoration: none; color: inherit; }

        /* 전체 레이아웃 */
        .container { display: flex; flex-direction: column; height: 100vh; }
        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }
        main { flex-grow: 1; overflow-y: auto; padding: 20px; }
        footer { background-color: #fff; border-top: 1px solid #ddd; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; }

        /* 탭 메뉴 */
        .tab-menu { display: flex; justify-content: space-around; padding: 10px 0; border-bottom: 1px solid #ddd; }
        .tab-button { padding: 10px 15px; border-radius: 8px; color: #888; }
        .tab-button.active { color: #0a84ff; font-weight: bold; }

        /* 검색 바 */
        .search-bar { display: flex; align-items: center; background-color: #fff; border-radius: 10px; padding: 8px 15px; margin-bottom: 20px; border: 1px solid #eee; }
        .search-bar input { border: none; outline: none; flex-grow: 1; margin-left: 10px; font-size: 16px; }
        .search-bar button { color: #888; }

        /* 아티스트 목록 */
        .artist-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .artist-item { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .artist-item img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
        .artist-item span { font-size: 14px; }

        /* 아티스트 상세 정보 */
        .artist-detail { display: none; } /* Initially hidden */
        .artist-header { position: relative; height: 200px; overflow: hidden; border-radius: 15px; margin-bottom: 20px; }
        .artist-header img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: blur(10px) brightness(0.7); }
        .artist-header-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #fff; }
        .artist-header-content h2 { font-size: 2.5em; margin-bottom: 5px; }
        .artist-header-content p { font-size: 1.2em; }
        .popular-songs { margin-top: 20px; }
        .popular-songs h3 { margin-bottom: 15px; font-weight: bold; }
        .song-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .song-item:last-child { border-bottom: none; }
        .song-item img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-right: 15px; }
        .song-info { flex-grow: 1; }
        .song-title { font-weight: bold; }
        .song-artist { color: #777; font-size: 14px; }
        .song-actions button { margin-left: 10px; color: #777; font-size: 1.2em; }

        /* 플레이어 */
        #audio-player { display: flex; align-items: center; }
        #album-cover-mini { width: 40px; height: 40px; border-radius: 5px; object-fit: cover; margin-right: 10px; }
        #player-info { flex-grow: 1; }
        #player-title { font-weight: bold; font-size: 14px; }
        #player-artist { color: #777; font-size: 12px; }
        #player-controls button { font-size: 1.5em; color: #555; margin: 0 8px; }
        #player-controls button.play-pause { font-size: 2em; color: #000; }

        /* 가사 영역 */
        #lyrics-container { text-align: center; margin-top: 20px; }
        #lyrics-container p { line-height: 1.8; color: #555; }
        #lyrics-container p.current-lyric { color: #000; font-weight: bold; font-size: 1.1em; }

        /* 유틸리티 클래스 */
        .hidden { display: none !important; }
        .highlight { color: #0a84ff; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div><button class="back-button" onclick="history.back()" style="font-size: 1.2em;"><</button> 보관함</div>
            <button class="menu-button" style="font-size: 1.5em;">☰</button>
        </header>

        <main>
            <section id="artist-list-section">
                <div class="search-bar">
                    <span style="color: #888;"></span>
                    <input type="text" placeholder="검색">
                    <button><span style="color: #888;"></span></button>
                </div>

                <div class="artist-list">
                    <div class="artist-item" onclick="showArtistDetail('newjeans')">
                        <img src="http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg" alt="NewJeans">
                        <span>뉴진스</span>
                    </div>
                    </div>
            </section>

            <section id="artist-detail-section" class="artist-detail hidden">
                <div class="artist-header">
                    <img src="http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg" alt="NewJeans Album Art">
                    <div class="artist-header-content">
                        <h2>뉴진스</h2>
                        <p>NewJeans</p>
                    </div>
                </div>

                <div class="popular-songs">
                    <h3>인기곡</h3>
                    <ul id="song-list">
                        <li class="song-item" data-song-id="eta">
                            <img src="http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg" alt="ETA Album Art">
                            <div class="song-info">
                                <div class="song-title">ETA</div>
                                <div class="song-artist">NewJeans</div>
                            </div>
                            <div class="song-actions">
                                <button><span style="color: #888;">⋯</span></button>
                            </div>
                        </li>
                        <li class="song-item" data-song-id="supernatural">
                            <img src="http://www.applesodam.kro.kr/music/NewJeans/Supernatural-Single/Supernatural-Single.jpg" alt="Supernatural Album Art">
                            <div class="song-info">
                                <div class="song-title">Supernatural</div>
                                <div class="song-artist">NewJeans</div>
                            </div>
                            <div class="song-actions">
                                <button><span style="color: #888;">⋯</span></button>
                            </div>
                        </li>
                        <li class="song-item" data-song-id="howsweet">
                            <img src="http://www.applesodam.kro.kr/music/NewJeans/HowSweet-EP/HowSweet-EP.jpg" alt="How Sweet Album Art">
                            <div class="song-info">
                                <div class="song-title">How Sweet</div>
                                <div class="song-artist">NewJeans</div>
                            </div>
                            <div class="song-actions">
                                <button><span style="color: #888;">⋯</span></button>
                            </div>
                        </li>
                    </ul>
                </div>
            </section>

            <section id="lyrics-view" class="hidden">
                <div id="lyrics-container">
                    <p id="current-lyric-text"></p>
                    <p id="next-lyric-text"></p>
                </div>
            </section>
        </main>

        <footer>
            <div id="audio-player">
                <img id="album-cover-mini" src="http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg" alt="Album Cover">
                <div id="player-info">
                    <div id="player-title">곡 제목</div>
                    <div id="player-artist">아티스트</div>
                </div>
                <div id="player-controls">
                    <button><span class="material-symbols-rounded">skip_previous</span></button>
                    <button class="play-pause" onclick="togglePlayPause()"><span class="material-symbols-rounded">play_arrow</span></button>
                    <button><span class="material-symbols-rounded">skip_next</span></button>
                </div>
            </div>
        </footer>
    </div>

    <audio id="audio" preload="metadata"></audio>

    <script>
        const audio = document.getElementById('audio');
        const albumCoverMini = document.getElementById('album-cover-mini');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const playPauseButton = document.querySelector('#player-controls .play-pause span');
        const songList = document.getElementById('song-list');
        const lyricsContainer = document.getElementById('lyrics-container');
        const currentLyricText = document.getElementById('current-lyric-text');
        const nextLyricText = document.getElementById('next-lyric-text');

        let currentSongId = null;
        let isPlaying = false;
        let lyricsData = [];
        let lyricIndex = 0;

        const songs = {
            'eta': {
                title: 'ETA',
                artist: 'NewJeans',
                albumArtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP\'GetUp\'/NewJeans2ndEP\'GetUp\'.jpg',
                mp3Url: 'http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP\'GetUp\'/ETA.mp3',
                srtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP\'GetUp\'/ETA.srt'
            },
            'supernatural': {
                title: 'Supernatural',
                artist: 'NewJeans',
                albumArtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/Supernatural-Single/Supernatural-Single.jpg',
                mp3Url: 'http://www.applesodam.kro.kr/music/NewJeans/Supernatural-Single/Supernatural.mp3',
                srtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/Supernatural-Single/Supernatural.srt' // Need to create dummy srt or find real one
            },
            'howsweet': {
                title: 'How Sweet',
                artist: 'NewJeans',
                albumArtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/HowSweet-EP/HowSweet-EP.jpg',
                mp3Url: 'http://www.applesodam.kro.kr/music/NewJeans/HowSweet-EP/HowSweet.mp3',
                srtUrl: 'http://www.applesodam.kro.kr/music/NewJeans/HowSweet-EP/HowSweet.srt' // Need to create dummy srt or find real one
            }
        };


        function showArtistDetail(artistId) {
            document.getElementById('artist-list-section').classList.add('hidden');
            document.getElementById('artist-detail-section').classList.remove('hidden');
            document.querySelector('header > div').textContent = "< 아티스트"; // Header text change
        }

        function loadSong(songId) {
            currentSongId = songId;
            const song = songs[songId];
            albumCoverMini.src = song.albumArtUrl;
            playerTitle.textContent = song.title;
            playerArtist.textContent = song.artist;
            audio.src = song.mp3Url;
            lyricsData = []; // Reset lyrics data
            lyricIndex = 0;
            currentLyricText.textContent = '';
            nextLyricText.textContent = '';

            fetch(song.srtUrl)
                .then(response => {
                    if (!response.ok) {
                        console.error(`Failed to fetch SRT file: ${response.status} ${response.statusText}`);
                        return Promise.reject('Failed to load SRT file'); // Reject the promise on error
                    }
                    return response.text();
                })
                .then(srtText => {
                    lyricsData = parseSRT(srtText);
                    if (lyricsData.length > 0) {
                        lyricsContainer.classList.remove('hidden'); // Show lyrics container if lyrics are available
                    } else {
                        lyricsContainer.classList.add('hidden'); // Hide if no lyrics data
                    }
                })
                .catch(error => {
                    console.error("Error loading SRT:", error);
                    lyricsContainer.classList.add('hidden'); // Hide lyrics container on error
                    lyricsData = []; // Ensure lyricsData is empty on error
                });
        }


        function parseSRT(srtText) {
            const lines = srtText.trim().split('\n');
            const lyrics = [];
            let i = 0;
            while (i < lines.length) {
                if (!lines[i].trim()) { // Skip empty lines
                    i++;
                    continue;
                }
                const index = parseInt(lines[i++].trim(), 10); // Index - not used but parse it anyway
                const timeLine = lines[i++].trim();
                const lyricText = lines[i++];

                if (!timeLine || !lyricText) {
                    continue; // Skip if timeLine or lyricText is missing
                }

                const times = timeLine.split('-->').map(t => {
                    const parts = t.trim().split(/[:,.]/);
                    return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(parts[2]) + parseInt(parts[3]) / 1000; // HH:MM:SS,MS to seconds
                });

                if (times.length === 2) {
                    lyrics.push({ start: times[0], end: times[1], text: lyricText.trim() });
                }
            }
            return lyrics;
        }


        function togglePlayPause() {
            if (!currentSongId) {
                // If no song loaded, load the first song in the list (e.g., ETA)
                const firstSongItem = document.querySelector('#song-list .song-item');
                if (firstSongItem) {
                    loadSong(firstSongItem.dataset.songId);
                } else {
                    return; // No songs to play
                }
            }

            if (isPlaying) {
                audio.pause();
                playPauseButton.textContent = 'play_arrow';
            } else {
                audio.play();
                playPauseButton.textContent = 'pause';
                if (lyricsData.length > 0) {
                    updateLyrics(); // Start updating lyrics when playing starts
                }
            }
            isPlaying = !isPlaying;
        }


        function updateLyrics() {
            if (lyricsData.length === 0 || !isPlaying) return;

            const currentTime = audio.currentTime;
            let foundLyric = false;

            // Find the current lyric
            for (let i = 0; i < lyricsData.length; i++) {
                if (currentTime >= lyricsData[i].start && currentTime <= lyricsData[i].end) {
                    if (lyricIndex !== i) { // Only update if index changed to prevent unnecessary updates
                        currentLyricText.textContent = lyricsData[i].text;
                        nextLyricText.textContent = (i < lyricsData.length - 1) ? lyricsData[i + 1].text : ''; // Show next lyric, if available
                        lyricIndex = i;
                    }
                    foundLyric = true;
                    break; // Lyric found, exit loop
                }
            }

            if (!foundLyric) {
                currentLyricText.textContent = ''; // Clear lyric if no match
                nextLyricText.textContent = (lyricsData.length > 0) ? lyricsData[0].text : ''; // Optionally show first lyric as 'next'
                lyricIndex = -1; // Reset lyric index
            }


            if (isPlaying) {
                requestAnimationFrame(updateLyrics); // Smoothly update lyrics
            }
        }


        // Event listeners for song list items
        songList.addEventListener('click', function(e) {
            const targetSongItem = e.target.closest('.song-item');
            if (targetSongItem) {
                const songId = targetSongItem.dataset.songId;
                loadSong(songId);
                togglePlayPause(); // Auto play when song is selected from list
                document.getElementById('artist-detail-section').classList.add('hidden'); // Hide artist detail
                document.getElementById('lyrics-view').classList.remove('hidden'); // Show lyrics view
                document.querySelector('header > div').textContent = "< 보관함"; // Change header back
            }
        });

        // 초기 로딩 시 'ETA' 곡 로드 (선택 사항)
        // window.addEventListener('DOMContentLoaded', () => {
        //     loadSong('eta'); // Optionally load 'eta' on initial page load
        // });


    </script>
     <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</body>
</html>
