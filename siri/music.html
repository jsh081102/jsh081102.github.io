<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music</title>
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: #f0f0f0;
            color: #333;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full viewport height */
            overflow: hidden; /* Prevent scrollbars */
        }

        /* Top Bar (Status Bar) */
        .status-bar {
            height: 24px;
            background-color: #e0e0e0;
            text-align: center;
            font-size: 14px;
            padding: 2px 0;
            color: #666;
            position: sticky; /* Keeps it at the top */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 10; /* Make sure it's above other elements */
        }


        /* Main Content Area */
        .main-content {
            flex-grow: 1; /* Take up remaining space */
            overflow-y: auto; /* Scrollable content */
            padding: 20px;
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack elements vertically */
        }

        /* Navigation Bar (Bottom) */
        .navigation-bar {
            background-color: #fff;
            border-top: 1px solid #ccc;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            position: sticky; /* Fixed at the bottom */
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10; /* Make sure it's above other elements */
        }
        .navigation-bar button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px; /* Icon size */
            color: #0a84ff; /* Highlight color */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center icon and text */
            padding: 5px;
            border-radius: 8px; /* Rounded corners */
        }
        .navigation-bar button span {
             font-size: 12px; /* Text size below icon */
             margin-top: 2px; /* Space between icon and text */
         }

        .navigation-bar button:hover, .navigation-bar button:focus {
            background-color: rgba(10, 132, 255, 0.1); /* Lighter highlight on hover/focus */
        }

        /* Artist List */
        .artist-list {
            display: flex;
            flex-wrap: wrap; /* Allow items to wrap */
            gap: 20px; /* Space between items */
            margin-bottom: 20px; /* Space below the list */
        }

        .artist-item {
            width: 100px; /* Fixed width */
            text-align: center;
            cursor: pointer;
            border-radius: 12px; /* Rounded corners */
            overflow: hidden; /* Clip image to rounded corners */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow */
            transition: transform 0.2s ease; /* Smooth transform on hover */
        }

        .artist-item:hover {
            transform: translateY(-3px); /* Slight lift on hover */
        }

        .artist-item img {
            width: 100%; /* Make image fill the container */
            height: 100px;
            object-fit: cover; /* Cover the area, maintaining aspect ratio */
            border-bottom: 1px solid #eee; /* Separator */
        }

        .artist-item p {
            padding: 8px;
            font-size: 14px;
            background-color: #fff;
            white-space: nowrap;  /* Prevent text wrapping */
            overflow: hidden;      /* Hide overflow */
            text-overflow: ellipsis; /* Show ellipsis for long names */
        }


       /* Album List (Initially hidden) */
        .album-list {
            display: none; /* Hidden by default */
            flex-wrap: wrap;
            gap: 15px;
        }

        .album-item {
            width: 150px; /* Larger than artist items */
            text-align: center;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
            transition: transform 0.2s ease;
        }

        .album-item:hover {
            transform: scale(1.05); /* Slightly enlarge on hover */
        }

        .album-item img {
            width: 100%;
            height: 150px; /* Matching width */
            object-fit: cover;
            border-bottom: 1px solid #eee;
        }

        .album-item p {
            padding: 10px;
            font-size: 15px;
            background-color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Now Playing Bar (Initially hidden) */
        .now-playing-bar {
            background-color: #fff;
            border-top: 1px solid #ccc;
            padding: 10px;
            display: none; /* Hidden by default */
            position: fixed; /* Fixed positioning */
            bottom: 49px;     /* Place just above the navigation bar */
            left: 0;
            width: 100%;
            z-index: 5; /* Below the navigation bar, above other content */
            flex-direction: row; /* Horizontal layout */
            align-items: center; /* Vertically center items */
            gap: 10px; /* Space between elements */
        }


        .now-playing-bar img {
            width: 50px;
            height: 50px;
            border-radius: 8px; /* Rounded corners */
            object-fit: cover; /* Ensure the image covers the space */
        }

        .now-playing-info {
            flex-grow: 1; /* Take up available space */
            overflow: hidden; /* Hide overflow */
            margin-right: 15px;
        }

        .now-playing-info p {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px;
        }

        .now-playing-info p:first-child {
            font-weight: bold; /* Song title is bold */
        }
        .now-playing-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .now-playing-controls button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px; /* Larger icons */
            color: #0a84ff;
            padding: 5px; /* Add some padding */
            border-radius: 50%; /* Circular buttons */

        }

         .now-playing-controls button:hover, .now-playing-controls button:focus {
            background-color: rgba(10, 132, 255, 0.1);
         }


        /*  Lyrics Display */
        #lyrics-display {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white */
            border-radius: 10px;
            text-align: center;
            font-size: 16px;
            line-height: 1.5;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden; /* Prevents overflow initially */
            max-height: 200px; /* Limit the height */
            transition: max-height 0.5s ease;
       }

       #lyrics-display.expanded {
            max-height: 500px; /* Or whatever the maximum you want */
            overflow-y: auto; /* Scrollable if content overflows */
       }


       /*  Back Button */
        .back-button {
            position: absolute; /* Position it absolutely */
            top: 30px;       /* Just below status bar */
            left: 10px;      /* Left edge */
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #0a84ff;
            z-index: 10; /* Make sure it's above the content */
            display: none; /* Hidden by default */
       }

       /* Loading Overlay */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100; /* Very high z-index */
            color: white;
            font-size: 20px;
        }

       /* Album view styles */
        #album-view {
            display: none;  /* Hidden by default */
            padding-top: 20px; /* Add space for back button */
            text-align: center; /* Center-align content */
        }
        #album-view img {
            width: 200px; /* Larger album art */
            height: 200px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }
        #album-view h2 { /* Album title */
            font-size: 22px;
            margin-bottom: 10px;
            color: #222;
        }
        #album-view p {  /* Artist name */
            font-size: 18px;
            color: #555;
            margin-bottom: 20px;
        }
        .track-list {
            list-style: none; /* Remove bullet points */
            padding: 0;
            margin: 0;
        }
        .track-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .track-item:last-child {
            border-bottom: none; /* No border on the last track */
        }
        .track-item:hover {
            background-color: rgba(10, 132, 255, 0.1);
        }
        .track-number {
            margin-right: 15px;
            color: #777;
            font-size: 14px;
            width: 25px; /* Fixed width */
            text-align: right; /* Right-align the number */
        }
        .track-title {
            flex-grow: 1; /* Title takes remaining space */
            font-size: 16px;
            color: #333;
             white-space: nowrap; /* Prevent wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ellipsis for long titles */
        }


    </style>
</head>
<body>
    <div class="status-bar" id="status-bar">12:00</div>
    <button class="back-button" id="back-button">← Back</button>

    <div class="main-content">
        <div class="artist-list" id="artist-list">
            <!-- Artist items will be added here -->
        </div>

        <div class="album-list" id="album-list">
              <!-- Album items will be added here -->
        </div>

         <div id="album-view">
            <!-- Album details and track list -->
            <img id="album-view-image" src="" alt="Album Cover">
            <h2 id="album-view-title"></h2>
            <p id="album-view-artist"></p>
            <ul class="track-list" id="album-track-list">
            <!-- Tracks will be added here -->
            </ul>
        </div>

        <div id="lyrics-display"></div>
    </div>

     <div class="now-playing-bar" id="now-playing-bar">
        <img id="now-playing-image" src="" alt="Now Playing">
        <div class="now-playing-info">
            <p id="now-playing-title"></p>
            <p id="now-playing-artist"></p>
        </div>
        <div class="now-playing-controls">
            <button id="prev-button">⏮</button>
            <button id="play-pause-button">▶</button>
            <button id="next-button">⏭</button>
        </div>
    </div>

    <div class="navigation-bar">
        <button id="home-button">
            <span class="material-symbols-outlined">
                home
            </span>
            <span>홈</span>
        </button>
        <button id="browse-button">
             <span class="material-symbols-outlined">
                search
             </span>
            <span>검색</span>
        </button>
        <button id="library-button">
             <span class="material-symbols-outlined">
                library_music
             </span>
            <span>보관함</span>
        </button>
    </div>

    <div id="loading-overlay">
        Loading...
    </div>

    <audio id="audio-player"></audio>

    <script>
        // Data for artists, albums, and songs
        const musicData = {
            artists: [
                {
                    name: "NewJeans",
                    image: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg",
                    albums: [
                        {
                            title: "NewJeans 2nd EP 'Get Up'",
                            image: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg",
                            songs: [
                                {
                                    title: "ETA",
                                    file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
                                    lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt"
                                },
                                {
                                    title: "Super Shy",
                                    file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.mp3",
                                    lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.srt"
                                },
                                 {
                                    title: "New Jeans",
                                    file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans.mp3",
                                    lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans.srt"
                                }
                            ]
                        }
                    ]
                }
            ]
        };



        // DOM Elements
        const artistList = document.getElementById('artist-list');
        const albumList = document.getElementById('album-list');
        const nowPlayingBar = document.getElementById('now-playing-bar');
        const nowPlayingImage = document.getElementById('now-playing-image');
        const nowPlayingTitle = document.getElementById('now-playing-title');
        const nowPlayingArtist = document.getElementById('now-playing-artist');
        const playPauseButton = document.getElementById('play-pause-button');
        const audioPlayer = document.getElementById('audio-player');
        const lyricsDisplay = document.getElementById('lyrics-display');
        const backButton = document.getElementById('back-button');
        const loadingOverlay = document.getElementById('loading-overlay');
        const albumView = document.getElementById('album-view');
        const albumViewImage = document.getElementById('album-view-image');
        const albumViewTitle = document.getElementById('album-view-title');
        const albumViewArtist = document.getElementById('album-view-artist');
        const albumTrackList = document.getElementById('album-track-list');
        const nextButton = document.getElementById('next-button');
        const prevButton = document.getElementById('prev-button');
        const homeButton = document.getElementById('home-button');
        const browseButton = document.getElementById('browse-button');
        const libraryButton = document.getElementById('library-button');
        const statusBar = document.getElementById('status-bar');

        let currentArtist = null;
        let currentAlbum = null;
        let currentSongIndex = 0;
        let lyrics = [];
        let currentLyricsIndex = -1;
        let lyricsInterval;
        let isPlaying = false;


        // --- Utility Functions ---

        // Function to update the status bar with the current time
        function updateStatusBarTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            statusBar.textContent = `${hours}:${minutes}`;
        }

        // Function to show loading overlay
        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }

        // Function to hide loading overlay
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }

        // Function to parse SRT file content
        function parseSRT(srtContent) {
          const lines = srtContent.trim().split('\n\n');
          return lines.map(line => {
            const parts = line.split('\n');
            const [index, time, ...text] = parts; // Destructure
            const [start, end] = time.split(' --> ');

            return {
              index: parseInt(index, 10),
              start: parseTime(start),
              end: parseTime(end),
              text: text.join('<br>') // Join multiple lines with <br>
            };
          });
        }

        // Function to parse time string (00:00:00,000) into seconds
        function parseTime(timeString) {
            const [hh, mm, ss_ms] = timeString.split(':');
            const [ss, ms] = ss_ms.split(',');
            return parseInt(hh, 10) * 3600 + parseInt(mm, 10) * 60 + parseInt(ss, 10) + parseInt(ms, 10) / 1000;
        }

        // --- UI Update Functions ---

        function displayArtists() {
            artistList.innerHTML = ''; // Clear existing list
            musicData.artists.forEach(artist => {
                const artistItem = document.createElement('div');
                artistItem.classList.add('artist-item');
                artistItem.innerHTML = `
                    <img src="${artist.image}" alt="${artist.name}">
                    <p>${artist.name}</p>
                `;
                artistItem.addEventListener('click', () => showAlbums(artist));
                artistList.appendChild(artistItem);
            });
        }

        function showAlbums(artist) {
            currentArtist = artist; // Store current artist

            albumList.innerHTML = ''; // Clear existing list
            artist.albums.forEach(album => {
                const albumItem = document.createElement('div');
                albumItem.classList.add('album-item');
                albumItem.innerHTML = `
                    <img src="${album.image}" alt="${album.title}">
                    <p>${album.title}</p>
                `;
                albumItem.addEventListener('click', () => showAlbumDetails(album));
                albumList.appendChild(albumItem);
            });

            artistList.style.display = 'none'; // Hide artist list
            albumList.style.display = 'flex'; // Show album list
            backButton.style.display = 'block';
            lyricsDisplay.style.display = "none";
        }


         function showAlbumDetails(album) {
            currentAlbum = album;
             albumViewImage.src = album.image;
            albumViewTitle.textContent = album.title;
            albumViewArtist.textContent = currentArtist.name;
            albumTrackList.innerHTML = '';

            album.songs.forEach((song, index) => {
                const trackItem = document.createElement('li');
                trackItem.classList.add('track-item');
                trackItem.innerHTML = `
                    <span class="track-number">${index + 1}</span>
                    <span class="track-title">${song.title}</span>
                `;
                trackItem.addEventListener('click', () => playSong(index));
                albumTrackList.appendChild(trackItem);
            });

            albumList.style.display = 'none';
            albumView.style.display = 'block';
        }


       function playSong(songIndex) {
            currentSongIndex = songIndex;
            const song = currentAlbum.songs[currentSongIndex];

            showLoading();  // Show loading screen before starting
            audioPlayer.src = song.file;
            audioPlayer.load(); // Load the new source

            audioPlayer.oncanplaythrough = () => { // Use canplaythrough event
                hideLoading(); // Hide loading screen once audio is ready
                audioPlayer.play();
                isPlaying = true;
                playPauseButton.textContent = '||';
                updateNowPlayingBar();
                fetchAndDisplayLyrics(song.lyrics);  // Display lyrics
            };

            audioPlayer.onerror = () => {
                hideLoading(); // Hide if error
                alert("Error loading the song.");
            }
        }


         // Function to update Now Playing Bar
        function updateNowPlayingBar() {
             const song = currentAlbum.songs[currentSongIndex];
            nowPlayingImage.src = currentAlbum.image;
            nowPlayingTitle.textContent = song.title;
            nowPlayingArtist.textContent = currentArtist.name;
            nowPlayingBar.style.display = 'flex';
        }


        // Function to fetch, parse, and display lyrics
       function fetchAndDisplayLyrics(lyricsUrl) {
            if (!lyricsUrl) {
                lyricsDisplay.innerHTML = "No lyrics available.";
                lyricsDisplay.style.display = "block";
                clearInterval(lyricsInterval);
                return;
            }

            fetch(lyricsUrl)
                .then(response => {
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(srtContent => {
                    lyrics = parseSRT(srtContent);
                    currentLyricsIndex = -1; // Reset
                    lyricsDisplay.innerHTML = ''; // Clear previous lyrics
                    lyricsDisplay.style.display = "block"; // Show lyrics display
                    startLyricsDisplay();
                })
                .catch(error => {
                    console.error("Error fetching or parsing lyrics:", error);
                    lyricsDisplay.innerHTML = "Lyrics failed to load.";
                    lyricsDisplay.style.display = 'block';
                    clearInterval(lyricsInterval); // Stop any previous interval
                });
        }


        function startLyricsDisplay() {
           clearInterval(lyricsInterval); // Clear any existing interval

           lyricsInterval = setInterval(() => {
             const currentTime = audioPlayer.currentTime;

             // Find the correct lyric line
             let newIndex = lyrics.findIndex(lyric => currentTime >= lyric.start && currentTime < lyric.end);

             if (newIndex !== -1 && newIndex !== currentLyricsIndex) {
                currentLyricsIndex = newIndex;
                // Update the display, highlighting the current line
                lyricsDisplay.innerHTML = lyrics.map((lyric, index) => {
                    return `<div class="${index === currentLyricsIndex ? 'current-lyric' : ''}">${lyric.text}</div>`;
                }).join('');


             } else if (newIndex === -1 && currentLyricsIndex !== -1) {
                // No lyric for the current time, clear or handle as needed
                 if(currentTime >= lyrics[lyrics.length -1].end){
                    lyricsDisplay.innerHTML = "";
                    currentLyricsIndex = -1;
                 }
             }

           }, 100); // Check every 100ms
        }


        // --- Event Listeners ---

        // Play/Pause Button
        playPauseButton.addEventListener('click', () => {
            if (isPlaying) {
                audioPlayer.pause();
                playPauseButton.textContent = '▶';
            } else {
                audioPlayer.play();
                playPauseButton.textContent = '||';
            }
            isPlaying = !isPlaying;
        });

        // Next Button
        nextButton.addEventListener('click', () => {
             if (currentAlbum && currentSongIndex < currentAlbum.songs.length - 1) {
                playSong(currentSongIndex + 1);
            } else if (currentAlbum) {
                // If at the end of the album, loop to beginning
                playSong(0);
            }
        });

        // Previous Button
        prevButton.addEventListener('click', () => {
            if (currentAlbum && currentSongIndex > 0) {
                playSong(currentSongIndex - 1);
            } else if(currentAlbum){
                // If at the start of the album, go to last song.
                playSong(currentAlbum.songs.length - 1);
            }
        });

        // Back Button
        backButton.addEventListener('click', () => {
          if (albumView.style.display === 'block') {
            albumView.style.display = 'none';
            albumList.style.display = 'flex';

          } else if (albumList.style.display === 'flex') {
            albumList.style.display = 'none';
            artistList.style.display = 'flex';
            backButton.style.display = 'none'; // Hide on artist list
          }

          lyricsDisplay.style.display = "none";
        });


        // Home Button
        homeButton.addEventListener('click', () => {
            // Stop current song and reset
            audioPlayer.pause();
            audioPlayer.src = '';  // Clear the audio source
            isPlaying = false;
            playPauseButton.textContent = '▶'; // Reset to play icon

             // Hide all sections except the artist list
            albumList.style.display = 'none';
            albumView.style.display = 'none';
            nowPlayingBar.style.display = 'none';
            lyricsDisplay.style.display = 'none';  // Hide lyrics
            artistList.style.display = 'flex';
            backButton.style.display = 'none'; // Hide back button

        });

        // --- Initialization ---
        function init() {
            displayArtists();
            updateStatusBarTime(); // Set initial time
            setInterval(updateStatusBarTime, 60000); // Update every minute
        }

        init();


    </script>
</body>
</html>
