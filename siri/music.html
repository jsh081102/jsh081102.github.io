<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apple Music 스타일 음악 플레이어</title>
  <style>
    /* 기본 스타일 설정 */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background-color: #f7f7f7;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #player-container {
      background: #fff;
      width: 350px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border-radius: 12px;
      overflow: hidden;
    }
    #album-art {
      width: 100%;
      height: 350px;
      background: #eee;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #album-art img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }
    #track-info {
      padding: 15px;
      text-align: center;
    }
    #audioPlayer {
      width: 100%;
      outline: none;
    }
    #lyrics {
      padding: 15px;
      max-height: 150px;
      overflow-y: auto;
      background: #f0f0f0;
      font-size: 0.9em;
      line-height: 1.4;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <div id="player-container">
    <!-- 앨범 아트 영역 -->
    <div id="album-art">
      <img id="album-art-img" src="" alt="앨범 아트">
    </div>
    
    <!-- 트랙 정보 및 오디오 플레이어 -->
    <div id="track-info">
      <h2 id="track-title">NewJeans - ETA</h2>
      <audio id="audioPlayer" controls>
        <!-- 제공된 m4a 파일 URL 입력 -->
        <source src="https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.m4a" type="audio/mp4">
        브라우저가 오디오를 지원하지 않습니다.
      </audio>
    </div>
    
    <!-- 가사 표시 영역 -->
    <div id="lyrics">
      Loading lyrics...
    </div>
  </div>

  <!-- music-metadata-browser 라이브러리 추가 (CDN 제공) -->
  <script src="https://unpkg.com/music-metadata-browser/dist/music-metadata-browser.umd.js"></script>
  <script>
    // 음원 파일과 가사 파일의 URL 설정
    const audioUrl = "https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.m4a";
    const lyricsUrl = "https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.srt";

    // m4a 파일의 메타데이터를 파싱하여 앨범 아트 추출
    async function loadAlbumArt(url) {
      try {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        // m4a 파일은 'audio/mp4' 형식으로 파싱
        const metadata = await window.musicMetadata.parseBuffer(new Uint8Array(arrayBuffer), 'audio/mp4');
        if (metadata.common.picture && metadata.common.picture.length) {
          const pic = metadata.common.picture[0];
          const blob = new Blob([pic.data], { type: pic.format });
          const imageUrl = URL.createObjectURL(blob);
          document.getElementById("album-art-img").src = imageUrl;
        } else {
          // 앨범 아트가 없는 경우 기본 이미지나 대체 텍스트를 표시
          document.getElementById("album-art-img").alt = "앨범 아트 정보 없음";
        }
      } catch (error) {
        console.error("메타데이터 파싱 중 에러:", error);
      }
    }

    // SRT 형식의 가사를 불러와 화면에 출력
    async function loadLyrics(url) {
      try {
        const response = await fetch(url);
        const srtText = await response.text();
        // SRT 파일을 단순 텍스트로 표시 (원하는 경우 더 정교하게 파싱 가능)
        document.getElementById("lyrics").textContent = srtText;
      } catch (error) {
        console.error("가사 불러오기 에러:", error);
        document.getElementById("lyrics").textContent = "가사를 불러오지 못했습니다.";
      }
    }

    // 페이지 로딩 시 앨범 아트와 가사 정보를 가져옴
    loadAlbumArt(audioUrl);
    loadLyrics(lyricsUrl);
  </script>
</body>
</html>
