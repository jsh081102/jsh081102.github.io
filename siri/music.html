<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music</title>
    <style>
        /* Reset CSS */
        body, h1, h2, h3, p, ul, li {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
            overflow: hidden; /* Prevent scrollbars during transitions */
        }

        /* Main Container */
        #musicOS {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;  /* Prevent scrolling */
        }

        /* Top Bar */
        #top-bar {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        #top-bar h1 {
            font-size: 1.2em;
            font-weight: 600;
        }

        /* Navigation (Bottom Bar) */
        #bottom-nav {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #ddd;
            position: fixed; /* Fixed position at the bottom */
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 100; /* Ensure it's above other content */
        }

        #bottom-nav button {
            background: none;
            border: none;
            font-size: 1em;
            color: #0a84ff;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
        }
        #bottom-nav button:hover, #bottom-nav button.active {
            background-color: rgba(10, 132, 255, 0.1);
        }
        #bottom-nav button.active {
             color: #0a84ff;
             font-weight: bold;
        }


        /*  Main Content Areas (Home, Library, Search) */
        #content {
            flex-grow: 1;
            overflow-y: auto;  /* Allow vertical scrolling */
            position: relative; /* For absolute positioning of pages */
            padding-bottom: 60px; /* Make room for bottom-nav */
        }


       .page {
          position: absolute; /* Stack pages on top of each other */
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          padding: 20px;
          box-sizing: border-box;
          display: none; /* Hide by default */
          overflow-y: auto;  /* Allow vertical scrolling */
        }

        .page.active {
            display: block; /* Show active page */
        }


        /* Home Page */
        #home {
          display: flex;
          flex-direction: column;
        }


        #home h2 {
            margin-bottom: 15px;
        }


        .artist-grid, .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive grid */
            gap: 20px;
            margin-bottom: 30px; /* Add space between sections */
        }

        .artist-item, .album-item {
            text-align: center;
            cursor: pointer;  /* Indicate clickable */
        }

        .artist-item img, .album-item img {
            width: 100%;
            height: auto;
            border-radius: 8px; /* Rounded corners */
            margin-bottom: 8px;
        }


        /* Library Page */
        #library .album-grid{
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Responsive grid */
            gap: 20px;
            margin-bottom: 30px;
       }



        /* Search Page */
         #search-bar-container {
              display: flex;
              align-items: center;
              margin-bottom: 1rem;

         }

        #search-bar {
             flex-grow: 1;
             padding: .6rem;
             border: 1px solid #ccc;
             border-radius: .4rem;
             font-size: 1rem;
             margin-right: 0.5rem;
         }

        #search-button {
           background-color: #0a84ff;
           color: white;
           border: none;
           padding: 0.5rem 1rem;
           border-radius: 0.4rem;
           cursor: pointer;
           transition: background-color 0.2s;
        }
        #search-button:hover {
             background-color: #0766cc;
        }
         #search-results{
             list-style: none;
             padding: 0;

         }
         #search-results li{
             padding: .8rem;
             border-bottom: 1px solid #eee;
             cursor: pointer;
             transition: background-color 0.2s ease;
         }
         #search-results li:last-child{
              border-bottom: none;
         }
         #search-results li:hover{
              background-color: #f9f9f9;
         }
        /* Now Playing Bar */
        #now-playing-bar {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid #ddd;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed; /* Fixed at the bottom */
            bottom: 54px;  /* Above the bottom-nav */
            left: 0;
            width: 100%;
            z-index: 99; /* Ensure it's above content, below bottom-nav */
        }

        #now-playing-bar #album-art {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            margin-right: 10px;
        }

        #now-playing-bar #song-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* prevent text overflow */

        }

        #song-info #song-title {
            font-weight: bold;
             white-space: nowrap; /* Keep title on one line */
             overflow: hidden;
             text-overflow: ellipsis;  /* Add ... if it overflows */
        }

        #song-info #artist-name {
             color: #666;
             white-space: nowrap;
             overflow: hidden;
             text-overflow: ellipsis;
        }

        #now-playing-controls button {
            background: none;
            border: none;
            font-size: 1.2em;
            color: #0a84ff;
            cursor: pointer;
            margin: 0 5px;
        }


        /* Player Page (Fullscreen) */
         #player-page {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background-color: white;
              z-index: 200;
              display: none;  /* Hidden by default */
              flex-direction: column;
              overflow-y: auto;
         }

        #player-page.active {
           display: flex;
        }

        #player-header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              padding: 1rem;
              border-bottom: 1px solid #ddd;
         }

          #close-player {
               background: none;
               border: none;
               font-size: 1.5rem;
               color: #0a84ff;
               cursor: pointer;
           }


        #player-album-art {
            width: 80%;
            max-width: 400px; /* Limit maximum size */
            height: auto;
            margin: 2rem auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Add a subtle shadow */
        }


        #player-song-info {
            text-align: center;
            margin-bottom: 1rem;
            padding: 0 1rem;
        }

        #player-song-info #player-song-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        #player-song-info #player-artist-name {
            color: #666;
        }


        #lyrics-container {
            padding: 1rem;
            margin-bottom: 2rem; /* Space for controls */
            text-align: center;
            flex-grow: 1; /* Allow lyrics to fill available space */
            overflow-y: auto; /* Scroll if lyrics are long */
        }

        #lyrics-container p {
            margin-bottom: 0.5rem;
            line-height: 1.4;
            font-size: 1.2rem;

        }

        #lyrics-container .highlighted-lyric {
             color: #0a84ff;
             font-weight: bold;
         }


        #player-controls {
              display: flex;
              flex-direction: column;
              align-items: center;
              padding: 1rem;
              border-top: 1px solid #ddd;
         }
         #player-controls-main {
            display: flex;
            align-items: center;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 1rem;

         }


        #player-controls button {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: #0a84ff;
            cursor: pointer;
            padding: 0.5rem;
        }
        #play-pause-button {
          font-size: 2.5rem; /* Larger play/pause button */

        }

        #progress-bar-container {
            width: 90%;
            height: 8px;
            background-color: #ddd;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer; /* Indicate clickability */
        }

        #progress-bar {
            height: 100%;
            width: 0;
            background-color: #0a84ff;
            transition: width 0.1s linear;  /* Smooth progress transition */
        }
        #time-display {
           width : 90%;
           display: flex;
           justify-content: space-between;
           margin-top: 0.5rem;
           color: #666;
       }
        /* Additional Styles for a more refined look */
        .hidden {
            display: none;
        }
        .section-title {
            font-size: 1.4em;
            font-weight: bold;
            margin: 20px 0 10px 20px; /* Top Right Bottom Left */
            color: #222;
            text-transform: capitalize; /* Capitalize first letter */
        }

    </style>
</head>
<body>
    <div id="musicOS">
        <div id="top-bar">
            <h1>Siri Music</h1>
        </div>

        <div id="content">
            <!-- Home Page -->
            <div id="home" class="page active">

                <h2 class="section-title">Artists</h2>
                <div class="artist-grid">
                    <!-- Artist items will be added here -->
                </div>

                <h2 class="section-title">Albums</h2>
                 <div class="album-grid">
                    <!-- Album items will be added here dynamically -->
                 </div>
            </div>

             <!-- Library Page -->
           <div id="library" class="page">
               <h2 class="section-title">My Albums</h2>
               <div class="album-grid">
                   <!-- Library albums will be added here dynamically -->
               </div>
           </div>


            <!-- Search Page -->
            <div id="search" class="page">
                <div id="search-bar-container">
                    <input type="text" id="search-bar" placeholder="Search for songs, artists, albums...">
                    <button id="search-button">Search</button>
                </div>
                <ul id="search-results"></ul>
            </div>

           <!-- Fullscreen Player -->
            <div id="player-page">
                <div id="player-header">
                    <button id="close-player">←</button> <!-- Back arrow -->
                    <span>Now Playing</span>
                    <div></div> <!-- Empty div for spacing -->
                </div>

                <img id="player-album-art" src="" alt="Album Art">

                <div id="player-song-info">
                    <div id="player-song-title">Song Title</div>
                    <div id="player-artist-name">Artist Name</div>
                </div>

                <div id="lyrics-container">
                    <!-- Lyrics will be displayed here -->
                </div>

                <div id="player-controls">
                    <div id="progress-bar-container">
                        <div id="progress-bar"></div>
                    </div>
                    <div id="time-display">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>

                    <div id="player-controls-main">
                      <button id="prev-button">⏮</button> <!-- Previous -->
                      <button id="play-pause-button">⏯</button> <!-- Play/Pause -->
                      <button id="next-button">⏭</button> <!-- Next -->
                    </div>
                </div>
            </div>
        </div>


        <!-- Now Playing Bar -->
        <div id="now-playing-bar" class="hidden">
            <img id="album-art" src="" alt="Album Art">
            <div id="song-info">
                <div id="song-title">Song Title</div>
                <div id="artist-name">Artist Name</div>
            </div>
            <div id="now-playing-controls">
                <button id="mini-play-pause-button">⏯</button>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div id="bottom-nav">
            <button id="home-button" class="active">Home</button>
            <button id="library-button">Library</button>
            <button id="search-button">Search</button>
        </div>
    </div>

    <audio id="audio-player"></audio>

    <script>
     // --- Data (Normally, you'd fetch this from a server) ---
     const musicData = {
       artists: [
         {
           name: "NewJeans",
           image: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg",
           albums: [
             {
               title: "NewJeans 2nd EP 'Get Up'",
               artist: "NewJeans",
               image: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans2ndEP'GetUp'.jpg",
               songs: [
                 {
                   title: "ETA",
                   artist: "NewJeans",
                   file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
                   lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt",
                 },
                 {
                     title: "Super Shy",
                     artist: "NewJeans",
                     file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.mp3",
                     lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/SuperShy.srt"
                 },
                 {
                   title: "New Jeans",
                   artist: "NewJeans",
                   file: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans.mp3",
                   lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/NewJeans.srt"
                 }
               ],
             },
             {
              title : "How Sweet",
              artist: "NewJeans",
              image : "http://www.applesodam.kro.kr/music/NewJeans/HowSweet/HowSweet.jpg",
              songs: [
                 {
                   title: "How Sweet",
                   artist: "NewJeans",
                   file: "http://www.applesodam.kro.kr/music/NewJeans/HowSweet/HowSweet.mp3",
                   lyrics: "http://www.applesodam.kro.kr/music/NewJeans/HowSweet/HowSweet.srt"
                 }
               ]
             }
           ],
         },
         {
           name: "BTS",
           image: "http://www.applesodam.kro.kr/music/BTS/BTS.jpg", // Example - replace
           albums: [
               {
                   title: "Love Yourself: Answer",
                   artist: "BTS",
                   image: "http://www.applesodam.kro.kr/music/BTS/LoveYourselfAnswer.jpg",  // Example
                   songs: [
                       {
                           title: "IDOL",
                           artist: "BTS",
                           file: "http://www.applesodam.kro.kr/music/BTS/IDOL.mp3",  // Example
                           lyrics: "http://www.applesodam.kro.kr/music/BTS/IDOL.srt", // Example
                       }
                   ]
               }
           ]
         },
       ],
     };


        // --- DOM Element References ---
        const homeButton = document.getElementById('home-button');
        const libraryButton = document.getElementById('library-button');
        const searchPageButton = document.getElementById('search-button'); // For search page
        const homePage = document.getElementById('home');
        const libraryPage = document.getElementById('library');
        const searchPage = document.getElementById('search'); // Search page
        const nowPlayingBar = document.getElementById('now-playing-bar');
        const miniPlayPauseButton = document.getElementById('mini-play-pause-button');
        const albumArt = document.getElementById('album-art');
        const songTitle = document.getElementById('song-title');
        const artistName = document.getElementById('artist-name');
        const audioPlayer = document.getElementById('audio-player');
        const playerPage = document.getElementById('player-page');
        const closePlayerButton = document.getElementById('close-player');
        const playerAlbumArt = document.getElementById('player-album-art');
        const playerSongTitle = document.getElementById('player-song-title');
        const playerArtistName = document.getElementById('player-artist-name');
        const lyricsContainer = document.getElementById('lyrics-container');
        const playPauseButton = document.getElementById('play-pause-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const totalTimeDisplay = document.getElementById('total-time');
        const searchBar = document.getElementById('search-bar');
        const searchButton = document.getElementById('search-button');
        const searchResultsList = document.getElementById('search-results');
        const artistGrid = document.querySelector('#home .artist-grid');
        const albumGrid = document.querySelector('#home .album-grid');
        const libraryAlbumGrid = document.querySelector('#library .album-grid');



        // --- State Variables ---
        let currentSong = null;
        let currentLyrics = null;
        let currentLyricIndex = -1;
        let isPlaying = false;
        let playlist = []; // Array to hold the current playlist
        let playlistIndex = 0; // Index of the currently playing song in the playlist


        // --- Event Listeners ---

        // Navigation
        homeButton.addEventListener('click', () => showPage('home'));
        libraryButton.addEventListener('click', () => showPage('library'));
        searchPageButton.addEventListener('click', () => showPage('search'));


        // Mini Play/Pause Button
        miniPlayPauseButton.addEventListener('click', togglePlayPause);

        // Close Player
        closePlayerButton.addEventListener('click', closePlayer);

        // Play/Pause Button (in Fullscreen Player)
        playPauseButton.addEventListener('click', togglePlayPause);

        // Previous/Next Buttons
        prevButton.addEventListener('click', playPreviousSong);
        nextButton.addEventListener('click', playNextSong);

        // Progress Bar Interaction
        progressBarContainer.addEventListener('click', seek);

        // Audio Player Events
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', playNextSong); // Play next when song ends
        audioPlayer.addEventListener('loadedmetadata', () => {
            totalTimeDisplay.textContent = formatTime(audioPlayer.duration);
        });

        //Search
        searchBar.addEventListener('keyup', handleSearchInput);
        searchButton.addEventListener('click', performSearch);

        // --- Initialization ---
        createArtistGrid();
        createAlbumGrid(musicData.artists.flatMap(artist => artist.albums), albumGrid);
        createAlbumGrid(musicData.artists.flatMap(artist => artist.albums), libraryAlbumGrid)
        showPage('home'); // Start on the home page


        // --- Function Definitions ---
        //-- Page show Function --
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            document.getElementById(pageId).classList.add('active');

             // Update active button in bottom navigation
            const navButtons = document.querySelectorAll('#bottom-nav button');
            navButtons.forEach(button => {
               button.classList.remove('active');
            });

           switch (pageId){
             case 'home':
                homeButton.classList.add('active');
                break;
             case 'library':
                libraryButton.classList.add('active');
                break;
             case 'search':
                searchPageButton.classList.add('active');
                break;
           }
        }

        // --- Music Playback Functions ---

        function loadAndPlaySong(song, album) {
           if (!song || !album) return;  // Check for null or undefined

           currentSong = song;
           audioPlayer.src = song.file;
           audioPlayer.load(); // Important to load before playing

            // Set metadata for Now Playing Bar
            albumArt.src = album.image;
            songTitle.textContent = song.title;
            artistName.textContent = song.artist;

            // Set metadata for Player Page
            playerAlbumArt.src = album.image;
            playerSongTitle.textContent = song.title;
            playerArtistName.textContent = song.artist;

            // Lyrics
            loadLyrics(song.lyrics);

            playAudio(); // Start playing after loading
            openPlayer(); // Show player page
            nowPlayingBar.classList.remove('hidden'); // Show now playing bar
        }


        function togglePlayPause() {
            if (!currentSong) return;  // Don't do anything if no song is loaded

            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

       function playAudio() {
            if (!currentSong) return;

            audioPlayer.play()
            .then(() => {
               isPlaying = true;
               updatePlayPauseButtons();
             })
            .catch(error => {
              console.error("Error playing audio:", error);
               // Handle the error appropriately, e.g., show a message to the user
            });
        }

        function pauseAudio() {
           if (!currentSong) return;

           audioPlayer.pause();
           isPlaying = false;
           updatePlayPauseButtons();
        }

        function updatePlayPauseButtons() {
            if (isPlaying) {
                miniPlayPauseButton.innerHTML = "⏸"; // Pause icon
                playPauseButton.innerHTML = "⏸";     // Pause icon
            } else {
                miniPlayPauseButton.innerHTML = "⏯"; // Play icon
                playPauseButton.innerHTML = "⏯";     // Play icon
            }
        }

        function playNextSong() {
          if (playlist.length === 0) return;

          playlistIndex = (playlistIndex + 1) % playlist.length; // Loop back to 0
          loadAndPlaySong(playlist[playlistIndex], findAlbumBySong(playlist[playlistIndex]));
        }

        function playPreviousSong() {
           if (playlist.length === 0) return;

           playlistIndex = (playlistIndex - 1 + playlist.length) % playlist.length; // Handle -1
           loadAndPlaySong(playlist[playlistIndex], findAlbumBySong(playlist[playlistIndex]));
        }


        function seek(event) {
            if (!currentSong) return;

            const clickX = event.offsetX;
            const barWidth = progressBarContainer.offsetWidth;
            const seekTime = (clickX / barWidth) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
        }

        function updateProgress() {
            if (!currentSong) return;

            const { currentTime, duration } = audioPlayer;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;

            currentTimeDisplay.textContent = formatTime(currentTime);
            // totalTimeDisplay.textContent = formatTime(duration); // Update this only on load

            // Lyrics Highlighting
            if (currentLyrics) {
               highlightLyrics(currentTime);
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00'; // Handle NaN case

            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            const formattedTime = `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
            return formattedTime;
        }

        // --- Lyrics Handling ---

        function loadLyrics(lyricsUrl) {
            if (!lyricsUrl) {
              lyricsContainer.innerHTML = '<p>No lyrics available.</p>'; // Display message
              currentLyrics = null;
              currentLyricIndex = -1;
              return;
            }

            fetch(lyricsUrl)
                .then(response => {
                    if (!response.ok) {
                       throw new Error(`Failed to fetch lyrics: ${response.status}`); // More specific error
                    }
                    return response.text();
                })
                .then(srtText => {
                    currentLyrics = parseSRT(srtText);
                    currentLyricIndex = -1; // Reset
                    lyricsContainer.innerHTML = ''; // Clear previous lyrics
                    displayLyrics(); // Initial display
                })
                .catch(error => {
                    console.error("Error loading lyrics:", error);
                    lyricsContainer.innerHTML = '<p>Error loading lyrics.</p>'; // Show error to user
                    currentLyrics = null;
                    currentLyricIndex = -1;
                });
        }


       function parseSRT(srtText) {
          const lines = srtText.trim().split('\n\n');
          return lines.map(line => {
             const parts = line.trim().split('\n');
             if (parts.length < 3) {
                console.warn("Invalid SRT line:", line);
                return null; // Or some other default object
             }
             const [index, timeRange, ...textLines] = parts;
             const [start, end] = timeRange.split(' --> ').map(parseTime);

             return {
                start,
                end,
                text: textLines.join('<br>') // Join multiple lines with <br>
             };
          }).filter(item => item !== null); // Filter out any null entries
        }


        function parseTime(timeString) {
            const [hours, minutes, secondsAndMillis] = timeString.split(':');
            const [seconds, milliseconds] = secondsAndMillis.split(',');
            return (parseInt(hours) * 3600 + parseInt(minutes) * 60 + parseInt(seconds) + parseInt(milliseconds) / 1000);
        }

        function displayLyrics() {
           lyricsContainer.innerHTML = ''; // Clear previous
           if (!currentLyrics) {
              lyricsContainer.innerHTML = '<p>No lyrics available.</p>';
              return;
           }
           currentLyrics.forEach((lyric, index) => {
              const p = document.createElement('p');
              p.innerHTML = lyric.text; // Use innerHTML as we have <br>
              p.dataset.index = index; // Store index for highlighting
              lyricsContainer.appendChild(p);
           });
        }


        function highlightLyrics(currentTime) {
          if (!currentLyrics) return;

          // Find the correct lyric index.
          let newLyricIndex = -1;
          for (let i = 0; i < currentLyrics.length; i++) {
             if (currentTime >= currentLyrics[i].start && currentTime <= currentLyrics[i].end) {
                 newLyricIndex = i;
                 break;
             }
           }

          // Only update if the lyric index has changed.
          if (newLyricIndex !== currentLyricIndex) {
             currentLyricIndex = newLyricIndex;

               // Remove highlighting from all lyrics
               const lyricParagraphs = lyricsContainer.querySelectorAll('p');
               lyricParagraphs.forEach(p => p.classList.remove('highlighted-lyric'));

               // Highlight the current lyric (if one is found)
               if (newLyricIndex !== -1) {
                  const highlightedLyric = lyricsContainer.querySelector(`p[data-index="${newLyricIndex}"]`);
                  if (highlightedLyric) {
                   highlightedLyric.classList.add('highlighted-lyric');
                   highlightedLyric.scrollIntoView({ behavior: 'smooth', block: 'center' }); //scroll smoothly
                  }
               }
            }
        }



        // --- Player Page Functions ---

        function openPlayer() {
            playerPage.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent main page scrolling
        }

        function closePlayer() {
            playerPage.classList.remove('active');
            document.body.style.overflow = ''; // Restore scrolling

        }

        // --- Search Functionality ---
       function handleSearchInput() {
          const searchTerm = searchBar.value;
          if (searchTerm.length > 2) { // search at least 3 characters
            performSearch(searchTerm);
          } else {
             searchResultsList.innerHTML = ''; // Clear results
          }
       }


        function performSearch(searchTerm) {
          // const searchTerm = searchBar.value.toLowerCase();
          const results = searchMusicData(searchTerm);
          displaySearchResults(results);
        }

        function searchMusicData(searchTerm) {
          searchTerm = searchTerm.toLowerCase();
          const results = [];

          musicData.artists.forEach(artist => {
             // Search in artist names
             if (artist.name.toLowerCase().includes(searchTerm)) {
                results.push({ type: 'artist', ...artist });
             }

              artist.albums.forEach(album => {
                  // Search in album titles
                 if (album.title.toLowerCase().includes(searchTerm)) {
                      results.push({ type: 'album', ...album });
                  }

                  album.songs.forEach(song => {
                      // Search in song titles
                     if (song.title.toLowerCase().includes(searchTerm)) {
                        results.push({ type: 'song', ...song, album: { image: album.image } }); // Add album info for display
                     }
                  });
              });
          });
          return results;
        }


       function displaySearchResults(results) {
          searchResultsList.innerHTML = ''; // Clear previous results

          if (results.length === 0) {
             searchResultsList.innerHTML = '<li>No results found</li>';
             return;
          }

          results.forEach(result => {
             const li = document.createElement('li');
             let resultText = '';

             switch (result.type) {
                 case 'artist':
                    resultText = `Artist: ${result.name}`;
                    break;
                case 'album':
                    resultText = `Album: ${result.title} by ${result.artist}`;
                    break;
                case 'song':
                     resultText = `Song: ${result.title} by ${result.artist}`;
                     break;
                 default:
                    resultText = 'Unknown result type';
            }

            li.textContent = resultText;
            li.addEventListener('click', () => {
                handleSearchResultClick(result);
            });
            searchResultsList.appendChild(li);
        });
    }

    function handleSearchResultClick(result) {
      switch (result.type) {
        case 'artist':
          // Handle artist click (e.g., show artist details)
          // For simplicity, we'll just log the artist name
          console.log('Artist clicked:', result.name);
          break;
        case 'album':
            showPage('library'); //가장 유사한 library 페이지로 이동.
            break;

        case 'song':
          // Play the song
          const album = findAlbumBySong(result);
          if (album) {
            //create a temporary playlist for this search result
            playlist = [result];
            playlistIndex = 0;
            loadAndPlaySong(result, album);
          }
          break;
      }
    }


        // --- UI Creation Functions ---

        function createArtistGrid() {
            musicData.artists.forEach(artist => {
                const artistItem = document.createElement('div');
                artistItem.classList.add('artist-item');
                artistItem.innerHTML = `
                    <img src="${artist.image}" alt="${artist.name}">
                    <p>${artist.name}</p>
                `;
                artistItem.addEventListener('click', () => {
                  //Show albums by this artist
                  const albumsByArtist = musicData.artists.find(a => a.name === artist.name).albums;
                  createAlbumGrid(albumsByArtist, albumGrid);
                  // Optionally, scroll to the album section:
                  albumGrid.scrollIntoView({ behavior: 'smooth' });
                });
                artistGrid.appendChild(artistItem);
            });
        }


        function createAlbumGrid(albums, gridContainer) {
            gridContainer.innerHTML = ''; // Clear existing albums

            albums.forEach(album => {
                const albumItem = document.createElement('div');
                albumItem.classList.add('album-item');
                albumItem.innerHTML = `
                    <img src="${album.image}" alt="${album.title}">
                    <p>${album.title}</p>
                `;

                albumItem.addEventListener('click', () => {
                  // Create a playlist from the album's songs and start playing
                  playlist = album.songs;
                  playlistIndex = 0; // Start from the first song.
                  loadAndPlaySong(playlist[playlistIndex], album);  // Pass the album object
                });

                gridContainer.appendChild(albumItem);
            });
        }


        // --- Helper Functions ---
        function findAlbumBySong(song) {
           for (const artist of musicData.artists) {
               for (const album of artist.albums) {
                   if (album.songs.some(s => s.title === song.title && s.artist === song.artist)) {
                       return album;
                   }
               }
           }
           return null;
        }

    </script>
</body>
</html>
