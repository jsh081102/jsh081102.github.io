<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Music Player - NewJeans</title>
    <style>
        body {
            background-color: #f2f2f2;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .player-container {
            width: 400px;
            margin: 50px auto;
            background-color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .album-art {
            width: 100%;
            height: 400px;
            background-size: cover;
            background-position: center;
        }
        .controls {
            padding: 20px;
            text-align: center;
        }
        .controls h2 {
            margin: 0;
            font-size: 24px;
        }
        .controls audio {
            width: 100%;
            margin-top: 15px;
            outline: none;
        }
        .lyrics {
            padding: 20px;
            height: 200px;
            overflow-y: auto;
            background-color: #fafafa;
            border-top: 1px solid #e6e6e6;
        }
        .lyrics p {
            margin: 5px 0;
            font-size: 16px;
            line-height: 1.5em;
        }
        .highlight {
            color: #d0021b;
        }
    </style>
</head>
<body>

<div class="player-container">
    <div class="album-art" id="albumArt"></div>
    <div class="controls">
        <h2 id="songTitle">NewJeans - ETA</h2>
        <audio id="audioPlayer" controls>
            <source src="https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.m4a" type="audio/mp4">
            Your browser does not support the audio element.
        </audio>
    </div>
    <div class="lyrics" id="lyricsContainer">
        <!-- 가사가 표시됩니다 -->
    </div>
</div>

<script>
    // 앨범 아트 추출 및 표시
    function loadAlbumArt() {
        const audioSrc = "https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.m4a";
        fetch(audioSrc)
            .then(response => response.arrayBuffer())
            .then(data => {
                // m4a 파일에서 메타데이터 추출
                const tags = {};
                const reader = new FileReader();
                reader.onloadend = function() {
                    const uint8Array = new Uint8Array(reader.result);
                    // 메타데이터 파싱 (라이브러리 사용 권장)
                    // 여기서는 예시로 대체합니다.
                    // 실제 구현 시 music-metadata-browser 등의 라이브러리를 사용하세요.
                    // tags.picture = 추출된 이미지 데이터;

                    // 예시로 기본 이미지 설정
                    document.getElementById('albumArt').style.backgroundImage = 'url("default_album_art.jpg")';
                };
                reader.readAsArrayBuffer(new Blob([data]));
            })
            .catch(error => {
                console.error('앨범 아트를 로드하는 중 오류 발생:', error);
                // 오류 시 기본 이미지 표시
                document.getElementById('albumArt').style.backgroundImage = 'url("default_album_art.jpg")';
            });
    }

    // 가사 로드 및 동기화
    function loadLyrics() {
        fetch("https://github.com/jsh081102/jsh081102.github.io/raw/refs/heads/main/misic/NewJeans2ndEP'GetUp'/ETA.srt")
            .then(response => response.text())
            .then(data => {
                const lyrics = parseSRT(data);
                displayLyrics(lyrics);
            })
            .catch(error => {
                console.error('가사를 로드하는 중 오류 발생:', error);
            });
    }

    function parseSRT(data) {
        const pattern = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3})\s*-->\s*(\d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\n|\n?$)/g;
        let result;
        const cues = [];

        while ((result = pattern.exec(data)) !== null) {
            cues.push({
                index: result[1],
                startTime: timeToSeconds(result[2]),
                endTime: timeToSeconds(result[3]),
                text: result[4].trim()
            });
        }

        return cues;
    }

    function timeToSeconds(time) {
        const parts = time.split(':');
        const seconds = parts[2].split(',');
        return parseInt(parts[0]) * 3600 + parseInt(parts[1]) * 60 + parseInt(seconds[0]) + parseInt(seconds[1]) / 1000;
    }

    function displayLyrics(cues) {
        const lyricsContainer = document.getElementById('lyricsContainer');
        lyricsContainer.innerHTML = '';
        cues.forEach(cue => {
            const p = document.createElement('p');
            p.textContent = cue.text;
            p.dataset.startTime = cue.startTime;
            p.dataset.endTime = cue.endTime;
            lyricsContainer.appendChild(p);
        });
    }

    function syncLyrics() {
        const audio = document.getElementById('audioPlayer');
        const lyricsContainer = document.getElementById('lyricsContainer');
        const lyrics = lyricsContainer.getElementsByTagName('p');

        for (let i = 0; i < lyrics.length; i++) {
            const start = parseFloat(lyrics[i].dataset.startTime);
            const end = parseFloat(lyrics[i].dataset.endTime);

            if (audio.currentTime >= start && audio.currentTime <= end) {
                lyrics[i].classList.add('highlight');
                lyricsContainer.scrollTop = lyrics[i].offsetTop - lyricsContainer.offsetTop - 50;
            } else {
                lyrics[i].classList.remove('highlight');
            }
        }
    }

    // 이벤트 리스너 설정
    document.addEventListener('DOMContentLoaded', () => {
        loadAlbumArt();
        loadLyrics();

        const audio = document.getElementById('audioPlayer');
        audio.addEventListener('timeupdate', syncLyrics);
    });
</script>

</body>
</html>
