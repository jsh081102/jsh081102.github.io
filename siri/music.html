<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Apple Music Style Streaming</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Overall layout and typography */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #f2f2f2;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    /* Container styled like a modern music player card */
    .player-container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 300px;
      padding: 20px;
      text-align: center;
    }
    /* Album art covers full width with subtle rounding */
    .album-art {
      width: 100%;
      border-radius: 8px;
    }
    /* Song and artist text styling */
    .song-title {
      font-size: 18px;
      margin-top: 10px;
      color: #333;
    }
    .artist-name {
      font-size: 14px;
      color: #777;
    }
    /* Lyrics area styling */
    .lyrics-display {
      margin-top: 20px;
      height: 150px;
      overflow: hidden;
      position: relative;
      background: #fafafa;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
      line-height: 1.6;
      text-align: left;
    }
    .lyrics-line {
      opacity: 0.5;
      transition: opacity 0.3s;
    }
    .lyrics-line.active {
      opacity: 1;
      font-weight: bold;
      color: #000;
    }
  </style>
</head>
<body>
  <div class="player-container">
    <!-- Album art image (will be set by JS after reading metadata) -->
    <img id="albumArt" class="album-art" src="" alt="Album Art">
    <!-- Song title and artist (to be populated from metadata) -->
    <div class="song-title" id="songTitle">Song Title</div>
    <div class="artist-name" id="artistName">Artist Name</div>
    <!-- Audio player with source pointing to the MP3 file -->
    <audio id="audioPlayer" controls style="width:100%; margin-top:10px;">
      <source src="http://www.applesodam.kro.kr/music/NewJeans2ndEP'GetUp'/ETA.mp3" type="audio/mpeg">
    </audio>
    <!-- Lyrics display container -->
    <div class="lyrics-display" id="lyricsDisplay"></div>
  </div>

  <!-- Include jsmediatags library to extract MP3 metadata -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
  <script>
    // Helper function to convert time string (e.g., "00:01:15,123" or "00:01:15.123") into seconds.
    function parseTime(timeString) {
      var parts = timeString.replace(',', '.').split(':');
      return parseFloat(parts[0]) * 3600 + parseFloat(parts[1]) * 60 + parseFloat(parts[2]);
    }

    // Function to parse SRT content into an array of objects {start, end, text}
    function parseSRT(data) {
      var pattern = /(\d+)\s+([\d:,\.]+)\s*-->\s*([\d:,\.]+)\s+([\s\S]*?)(?=\n\s*\n|\s*$)/g;
      var result = [];
      var match;
      while ((match = pattern.exec(data)) !== null) {
        var start = parseTime(match[2].trim());
        var end = parseTime(match[3].trim());
        var text = match[4].trim().replace(/\n/g, ' ');
        result.push({ start: start, end: end, text: text });
      }
      return result;
    }

    // Function to update the displayed lyrics based on the current audio time.
    function updateLyrics(lyrics, currentTime) {
      var lyricsDisplay = document.getElementById('lyricsDisplay');
      lyricsDisplay.innerHTML = ''; // Clear current lyrics
      for (var i = 0; i < lyrics.length; i++) {
        var lineElem = document.createElement('div');
        lineElem.className = 'lyrics-line';
        if (currentTime >= lyrics[i].start && currentTime <= lyrics[i].end) {
          lineElem.classList.add('active');
        }
        lineElem.textContent = lyrics[i].text;
        lyricsDisplay.appendChild(lineElem);
      }
    }

    // Global variable for storing parsed lyrics
    var lyricsArray = [];
    
    // Fetch the SRT file containing the lyrics.
    fetch("http://www.applesodam.kro.kr/music/NewJeans2ndEP'GetUp'/ETA.srt")
      .then(response => response.text())
      .then(data => {
        lyricsArray = parseSRT(data);
      })
      .catch(error => console.error("Error loading SRT file:", error));

    // Extract metadata (including album art, title, and artist) from the MP3 file.
    jsmediatags.read("http://www.applesodam.kro.kr/music/NewJeans2ndEP'GetUp'/ETA.mp3", {
      onSuccess: function(tag) {
        var tags = tag.tags;
        // If album art is available, convert binary data to a Base64 image URL.
        if (tags.picture) {
          var data = tags.picture.data;
          var format = tags.picture.format;
          var base64String = "";
          for (var i = 0; i < data.length; i++) {
            base64String += String.fromCharCode(data[i]);
          }
          var imageUrl = "data:" + format + ";base64," + btoa(base64String);
          document.getElementById('albumArt').src = imageUrl;
        } else {
          // Fallback image if album art is missing.
          document.getElementById('albumArt').src = "https://via.placeholder.com/300";
        }
        // Populate song title and artist from metadata.
        document.getElementById('songTitle').textContent = tags.title || "Unknown Title";
        document.getElementById('artistName').textContent = tags.artist || "Unknown Artist";
      },
      onError: function(error) {
        console.error("Error reading metadata:", error);
      }
    });

    // Listen to audio time updates and synchronize the lyrics display.
    var audioPlayer = document.getElementById('audioPlayer');
    audioPlayer.addEventListener('timeupdate', function() {
      if (lyricsArray.length > 0) {
        updateLyrics(lyricsArray, audioPlayer.currentTime);
      }
    });
  </script>
</body>
</html>
