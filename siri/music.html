<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Siri Music - musicOS 1.0</title>
  <style>
    /* Reset and basic styles */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f5f5f7; color: #1d1d1f; }
    header { padding: 16px; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center; font-size: 24px; font-weight: bold; }
    
    /* Main content and screen containers */
    #main-content { padding: 20px; }
    .screen { display: none; }
    .active { display: block; }
    
    /* Card styles for artists, albums, and songs */
    .artist-card, .album-card, .song-card {
      background: #fff;
      border-radius: 10px;
      padding: 10px;
      margin: 10px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .artist-card:hover, .album-card:hover, .song-card:hover { transform: scale(1.02); }
    .artist-card img, .album-card img { width: 100%; border-radius: 10px; }
    .card-container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
    .section-title { font-size: 20px; margin: 20px 0 10px; text-align: center; }
    
    /* Album screen header with video & random play */
    #album-header { position: relative; }
    #album-header video { width: 100%; border-radius: 10px; }
    #album-header .artist-name {
      position: absolute;
      bottom: 10px;
      left: 20px;
      color: #fff;
      font-size: 24px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.7);
    }
    #album-header .random-play-btn {
      position: absolute;
      top: 10px;
      right: 20px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      padding: 8px 12px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }
    
    /* Mini player styling */
    #mini-player {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fff;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }
    #mini-player img { width: 50px; height: 50px; border-radius: 5px; }
    #mini-player .song-info { font-size: 14px; }
    
    /* Full player overlay styling */
    #full-player {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      color: #fff;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    #full-player .player-container {
      background: #000;
      border-radius: 10px;
      width: 90%;
      max-width: 500px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #full-player img { width: 100%; border-radius: 10px; }
    #full-player .controls { margin-top: 10px; }
    #full-player button {
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      margin: 0 10px;
      cursor: pointer;
    }
    #lyrics-display { margin-top: 20px; text-align: center; font-size: 16px; line-height: 1.5; min-height: 50px; }
    #close-full-player {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>Siri Music</header>
  <div id="main-content">
    <!-- Artist Screen -->
    <div id="artist-screen" class="screen active">
      <div class="section-title">아티스트 선택</div>
      <div class="card-container" id="artist-container">
        <!-- Artist cards will be inserted here -->
      </div>
    </div>
    <!-- Album Screen -->
    <div id="album-screen" class="screen">
      <button onclick="goBack('artist')" style="margin-bottom:10px;">&larr; 돌아가기</button>
      <div id="album-header">
        <video id="artist-video" autoplay muted loop></video>
        <div class="artist-name" id="album-artist-name"></div>
        <button class="random-play-btn" onclick="randomPlay()">랜덤 재생</button>
      </div>
      <div class="section-title">앨범 목록</div>
      <div class="card-container" id="album-container">
        <!-- Album cards will be inserted here -->
      </div>
    </div>
    <!-- Songs Screen -->
    <div id="songs-screen" class="screen">
      <button onclick="goBack('album')" style="margin-bottom:10px;">&larr; 돌아가기</button>
      <div class="section-title" id="songs-album-title"></div>
      <div class="card-container" id="song-container">
        <!-- Song cards will be inserted here -->
      </div>
    </div>
  </div>
  <!-- Mini Player -->
  <div id="mini-player" style="display:none;">
    <img id="mini-album-art" src="" alt="Album Art">
    <div class="song-info" id="mini-song-title"></div>
  </div>
  <!-- Full Player Overlay -->
  <div id="full-player">
    <button id="close-full-player">✕</button>
    <div class="player-container">
      <img id="full-album-art" src="" alt="Album Art">
      <audio id="audio-player"></audio>
      <div class="controls">
        <button onclick="togglePlay()" id="play-pause-btn">▶</button>
      </div>
      <div id="lyrics-display">가사가 여기에 표시됩니다</div>
    </div>
  </div>
  <script>
    // Sample Data for demonstration
    const musicData = {
      "NewJeans": {
        artistImage: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.jpg",
        artistVideo: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans.mp4",
        albums: {
          "NewJeans2ndEP 'GetUp'": [
            {
              title: "ETA",
              audio: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
              lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt"
            }
          ]
        }
      },
      "IVE": {
        artistImage: "https://via.placeholder.com/300x300?text=IVE",
        artistVideo: "https://via.placeholder.com/560x315?text=IVE+Video",
        albums: {
          "IVE Debut Album": [
            {
              title: "Sample Song",
              audio: "http://www.applesodam.kro.kr/music/IVE/SampleSong.mp3",
              lyrics: "http://www.applesodam.kro.kr/music/IVE/SampleSong.srt"
            }
          ]
        }
      }
    };

    let currentArtist = null;
    let currentAlbum = null;
    let currentSong = null;
    const audioElement = document.getElementById('audio-player');
    let lyricsArray = [];

    // Load the Artist Screen
    function loadArtists() {
      const container = document.getElementById('artist-container');
      container.innerHTML = "";
      for (const artist in musicData) {
        const card = document.createElement('div');
        card.className = "artist-card";
        card.innerHTML = `<img src="${musicData[artist].artistImage}" alt="${artist}">
                          <div style="text-align:center; margin-top:5px;">${artist}</div>`;
        card.addEventListener('click', () => {
          currentArtist = artist;
          showAlbumScreen(artist);
        });
        container.appendChild(card);
      }
    }

    // Display the Album Screen for the selected artist
    function showAlbumScreen(artist) {
      setActiveScreen('album-screen');
      const artistData = musicData[artist];
      document.getElementById('album-artist-name').innerText = artist;
      document.getElementById('artist-video').src = artistData.artistVideo;
      const container = document.getElementById('album-container');
      container.innerHTML = "";
      for (const album in artistData.albums) {
        const card = document.createElement('div');
        card.className = "album-card";
        card.innerHTML = `<img src="${artistData.artistImage}" alt="${album}">
                          <div style="text-align:center; margin-top:5px;">${album}</div>`;
        card.addEventListener('click', () => {
          currentAlbum = album;
          showSongsScreen(artist, album);
        });
        container.appendChild(card);
      }
    }

    // Display the Songs Screen for the selected album
    function showSongsScreen(artist, album) {
      setActiveScreen('songs-screen');
      document.getElementById('songs-album-title').innerText = album;
      const songs = musicData[artist].albums[album];
      const container = document.getElementById('song-container');
      container.innerHTML = "";
      songs.forEach(song => {
         const card = document.createElement('div');
         card.className = "song-card";
         card.innerHTML = `<div style="text-align:center;">${song.title}</div>`;
         card.addEventListener('click', () => {
             currentSong = song;
             loadPlayer(song, artist);
         });
         container.appendChild(card);
      });
    }

    // Go back to previous screens
    function goBack(screen) {
      if(screen === 'artist'){
        setActiveScreen('artist-screen');
      } else if(screen === 'album'){
        setActiveScreen('album-screen');
      }
    }

    // Helper to set the active screen
    function setActiveScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    // Random play functionality from the current album
    function randomPlay() {
      const songs = musicData[currentArtist].albums[currentAlbum];
      const randomIndex = Math.floor(Math.random() * songs.length);
      currentSong = songs[randomIndex];
      loadPlayer(currentSong, currentArtist);
    }

    // Load the player for the selected song and show the mini player
    function loadPlayer(song, artist) {
      document.getElementById('mini-player').style.display = 'flex';
      document.getElementById('mini-album-art').src = musicData[artist].artistImage;
      document.getElementById('mini-song-title').innerText = song.title;
      setupAudioPlayer(song);
      audioElement.play();
    }

    // Setup the audio and fetch the synchronized lyrics
    function setupAudioPlayer(song) {
      audioElement.src = song.audio;
      loadLyrics(song.lyrics).then(lyrics => {
         lyricsArray = lyrics;
      }).catch(err => {
         console.error("가사 로드 실패:", err);
      });
    }

    // Fetch and parse the SRT file
    async function loadLyrics(url) {
      const response = await fetch(url);
      const srtText = await response.text();
      return parseSRT(srtText);
    }

    // Parse SRT into an array with startTime, endTime, and text
    function parseSRT(data) {
      const entries = data.trim().split('\n\n');
      let result = [];
      entries.forEach(entry => {
          const lines = entry.split('\n');
          if(lines.length >= 3) {
              const timeLine = lines[1];
              const times = timeLine.split(' --> ');
              const start = srtTimeToSeconds(times[0].trim());
              const end = srtTimeToSeconds(times[1].trim());
              const text = lines.slice(2).join(' ');
              result.push({ startTime: start, endTime: end, text: text });
          }
      });
      return result;
    }
    function srtTimeToSeconds(timeStr) {
      const parts = timeStr.replace(',', '.').split(':');
      const hours = parseFloat(parts[0]);
      const minutes = parseFloat(parts
