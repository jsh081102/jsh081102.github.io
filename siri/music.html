<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siri Music - musicOS 1.0</title>
    <style>
        /* 전역 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
        }

        /* 헤더 스타일 */
        .header {
            padding: 20px;
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            z-index: 1000;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        /* 메인 컨텐츠 */
        .main-content {
            margin-top: 80px;
            padding: 20px;
        }

        /* 아티스트 섹션 */
        .artist-section {
            margin-bottom: 40px;
        }

        .artist-header {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

        .artist-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .artist-info {
            position: absolute;
            bottom: 0;
            padding: 20px;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            width: 100%;
        }

        /* 앨범 그리드 */
        .album-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .album-item {
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .album-item:hover {
            transform: scale(1.05);
        }

        .album-cover {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 10px;
            object-fit: cover;
        }

        /* 플레이어 */
        .mini-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .full-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .lyrics-container {
            height: 300px;
            overflow-y: auto;
            text-align: center;
            margin-top: 20px;
        }

        .lyric-line {
            padding: 5px;
            transition: all 0.3s ease;
            opacity: 0.5;
        }

        .lyric-line.active {
            opacity: 1;
            font-size: 1.2em;
            font-weight: bold;
        }

        /* 컨트롤 버튼 */
        .controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Siri Music</div>
    </div>

    <div class="main-content">
        <div class="artist-section">
            <div class="artist-header">
                <video class="artist-video" autoplay muted loop>
                    <source src="http://www.applesodam.kro.kr/music/NewJeans/NewJeans.mp4" type="video/mp4">
                </video>
                <div class="artist-info">
                    <h1>NewJeans</h1>
                    <button class="control-btn play-btn">▶</button>
                </div>
            </div>
        </div>

        <div class="album-grid" id="albumGrid"></div>
    </div>

    <div class="mini-player" id="miniPlayer">
        <img src="" alt="현재 재생중" id="miniPlayerArt">
    </div>

    <div class="full-player" id="fullPlayer">
        <img src="" alt="앨범 아트" id="fullPlayerArt" style="width: 300px; height: 300px; border-radius: 10px;">
        <div class="lyrics-container" id="lyricsContainer"></div>
        <div class="controls">
            <button class="control-btn" id="prevBtn">⏮</button>
            <button class="control-btn" id="playPauseBtn">⏸</button>
            <button class="control-btn" id="nextBtn">⏭</button>
        </div>
    </div>

    <script>
        class MusicOS {
            constructor() {
                this.currentTrack = null;
                this.audio = new Audio();
                this.lyrics = [];
                this.currentLyricIndex = 0;

                this.initializeUI();
                this.bindEvents();
                this.loadAlbums();
            }

            initializeUI() {
                this.miniPlayer = document.getElementById('miniPlayer');
                this.fullPlayer = document.getElementById('fullPlayer');
                this.lyricsContainer = document.getElementById('lyricsContainer');
                this.albumGrid = document.getElementById('albumGrid');
            }

            bindEvents() {
                this.miniPlayer.addEventListener('click', () => this.toggleFullPlayer());
                this.audio.addEventListener('timeupdate', () => this.updateLyrics());
            }

            async loadAlbums() {
                // 실제 구현에서는 서버로부터 앨범 목록을 가져옴
                const albums = [
                    {
                        title: "NewJeans 2nd EP 'Get Up'",
                        cover: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/cover.jpg",
                        tracks: [
                            {
                                title: "ETA",
                                path: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
                                lyrics: "http://www.applesodam.kro.kr/music/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt"
                            }
                        ]
                    }
                ];

                this.renderAlbums(albums);
            }

            renderAlbums(albums) {
                this.albumGrid.innerHTML = albums.map(album => `
                    <div class="album-item">
                        <img src="${album.cover}" class="album-cover" alt="${album.title}">
                        <h3>${album.title}</h3>
                    </div>
                `).join('');
            }

            async playTrack(track) {
                this.currentTrack = track;
                this.audio.src = track.path;
                await this.loadLyrics(track.lyrics);
                this.audio.play();
                this.updateMiniPlayer();
            }

            async loadLyrics(lyricsPath) {
                try {
                    const response = await fetch(lyricsPath);
                    const text = await response.text();
                    this.lyrics = this.parseSRT(text);
                    this.renderLyrics();
                } catch (error) {
                    console.error('가사를 불러오는데 실패했습니다:', error);
                }
            }

            parseSRT(srtContent) {
                // SRT 파일 파싱 로직
                const lines = srtContent.split('\n');
                const lyrics = [];
                let currentLyric = {};

                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line.includes('-->')) {
                        const times = line.split('-->').map(time => this.timeToSeconds(time.trim()));
                        currentLyric.start = times[0];
                        currentLyric.end = times[1];
                    } else if (line && !line.match(/^\d+$/)) {
                        currentLyric.text = line;
                        lyrics.push({...currentLyric});
                        currentLyric = {};
                    }
                }

                return lyrics;
            }

            timeToSeconds(timeStr) {
                const [hours, minutes, seconds] = timeStr.split(':').map(Number);
                return hours * 3600 + minutes * 60 + seconds;
            }

            renderLyrics() {
                this.lyricsContainer.innerHTML = this.lyrics.map((lyric, index) => `
                    <div class="lyric-line" data-index="${index}">${lyric.text}</div>
                `).join('');
            }

            updateLyrics() {
                const currentTime = this.audio.currentTime;
                const activeLyricIndex = this.lyrics.findIndex(lyric => 
                    currentTime >= lyric.start && currentTime <= lyric.end
                );

                if (activeLyricIndex !== this.currentLyricIndex) {
                    document.querySelectorAll('.lyric-line').forEach(line => line.classList.remove('active'));
                    const activeLine = document.querySelector(`[data-index="${activeLyricIndex}"]`);
                    if (activeLine) {
                        activeLine.classList.add('active');
                        activeLine.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    this.currentLyricIndex = activeLyricIndex;
                }
            }

            updateMiniPlayer() {
                // 미니 플레이어 업데이트 로직
                document.getElementById('miniPlayerArt').src = this.currentTrack.cover;
            }

            toggleFullPlayer() {
                const isVisible = this.fullPlayer.style.display === 'flex';
                this.fullPlayer.style.display = isVisible ? 'none' : 'flex';
            }
        }

        // musicOS 인스턴스 생성
        window.addEventListener('DOMContentLoaded', () => {
            window.musicOS = new MusicOS();
        });
    </script>
</body>
</html>
