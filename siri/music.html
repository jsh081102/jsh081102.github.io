<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>음악 플레이어</title>
    <style>
        /* Reset CSS */
        body, h1, h2, h3, p, ul, li {
            margin: 0;
            padding: 0;
        }

        body {
            font-family: sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }

        /* Main Container */
        .container {
            display: flex;
        }

        /* Sidebar (Navigation) */
        .sidebar {
            width: 200px;
            background-color: #222;
            color: #fff;
            padding: 20px;
        }

        .sidebar ul li {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #444;
        }

        .sidebar ul li:hover {
            background-color: #333;
        }
         .sidebar ul {
            list-style: none; /* ul 태그의 리스트 스타일 제거 */
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 20px;
        }

        /* Music Category Grid (First Image Style) */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .category-item {
            background-color: #4CAF50; /* Example Color */
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
        }
          .category-item:hover {
                opacity: 0.8; /* 약간 투명하게 */
          }

        /* Player (Bottom) */
        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #333;
            color: #fff;
            padding: 10px;
            display: flex;
            align-items: center; /* 수직 중앙 정렬 */

        }

        /* Lyrics Display Area (Second Image Style) */
        .lyrics-area {
            position: fixed; /* 화면에 고정 */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            font-size: 20px;
            z-index: -1; /*  플레이어 뒤로 */
            backdrop-filter: blur(15px); /* 블러 효과 (모든 브라우저 지원은 아님) */
              transition: background-image 0.5s ease; /* 부드러운 배경 전환 */
        }

        /* Current Playing Info */
          .current-playing {
            margin-right: 20px;
            min-width: 150px; /* 텍스트가 잘리지 않도록 최소 너비 설정 */
        }
        .player audio {
            flex: 1; /* 오디오 컨트롤이 남은 공간을 모두 차지 */
        }
         /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 5px;
            background-color: #555;
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0;
        }

        #lyrics {
            padding: 30px;
            overflow: auto;
        }


    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar (Navigation) -->
        <aside class="sidebar">
            <ul>
                <li>홈</li>
                <li>새로운 음악</li>
                <li>라디오</li>
                <li>최근 추가된 항목</li>
                <li>아티스트</li>
              <li>앨범</li>
              <li>노래</li>
            </ul>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="category-grid">
                <div class="category-item" style="background-color: #4CAF50;">댄스</div>
                <div class="category-item" style="background-color: #f44336;">일렉트로닉</div>
                <div class="category-item" style="background-color: #2196F3;">K-Pop</div>
                <div class="category-item" style="background-color: #9C27B0;">힙합/랩</div>
                 <div class="category-item" style="background-color: #9C27B0;">R&B</div>
                 <div class="category-item" style="background-color: #2196F3;">재즈</div>
            </div>
        </main>

        <!-- Lyrics Display Area -->
        <div class="lyrics-area">
             <div id="lyrics"></div>
        </div>



        <!-- Player -->
        <div class="player">
            <div class="current-playing">
              <span id="current-song-title"></span> - <span id="current-artist"></span>
          </div>
            <audio id="audio-player" controls></audio>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
          </div>
        </div>
    </div>



    <script>
      // =========================================================================
      // Data (Easy to manage music and lyrics)
      // =========================================================================
      const musicData = [
          {
              artist: "NewJeans",
              title: "ETA",
              album: "NewJeans 2nd EP 'Get Up'",
              file: "/NewJeans/NewJeans2ndEP'GetUp'/ETA.mp3",
              lyrics: "/NewJeans/NewJeans2ndEP'GetUp'/ETA.srt",
              albumArt: "/NewJeans/NewJeans2ndEP'GetUp'/album_art.jpg" // Add album art path
          },
          // Add more songs here
      ];


      // =========================================================================
      // DOM Elements
      // =========================================================================
      const audioPlayer = document.getElementById('audio-player');
      const currentSongTitle = document.getElementById('current-song-title');
      const currentArtist = document.getElementById('current-artist');
      const lyricsArea = document.querySelector('.lyrics-area');
      const lyricsDiv = document.getElementById('lyrics');
      const progressBar = document.getElementById('progress-bar');
        const progressBarContainer = document.querySelector('.progress-bar-container');

      // =========================================================================
      // Variables
      // =========================================================================
      let currentSongIndex = 0;
      let lyricLines = []; //  가사 배열
      let currentLyricIndex = -1; // 현재 가사 인덱스


      // =========================================================================
      // Functions
      // =========================================================================

      // Load and Play a Song
        function loadAndPlaySong(index) {
            const song = musicData[index];
            if (!song) {
                console.error("Song not found at index:", index);
                return;
            }

            audioPlayer.src = song.file;
            currentSongTitle.textContent = song.title;
            currentArtist.textContent = song.artist;
            lyricsArea.style.backgroundImage = `url('${song.albumArt}')`; // Set album art
            audioPlayer.play();

            // Load lyrics
            loadLyrics(song.lyrics);
        }

      // --- Load Lyrics ---
      async function loadLyrics(lyricsFile) {
          try {
                const response = await fetch(lyricsFile);
              if (!response.ok) {
                    lyricsDiv.textContent = "가사를 찾을 수 없습니다.";
                    lyricLines = []; // 가사가 없으면 빈 배열로
                    currentLyricIndex = -1;
                    return;
                }
                const srtData = await response.text();

              lyricLines = parseSRT(srtData); // 가사 파싱
              currentLyricIndex = -1; //  가사 인덱스 초기화
              lyricsDiv.innerHTML = ''; // 가사 영역 초기화


          } catch (error) {
              console.error("Error loading lyrics:", error);
                lyricsDiv.textContent = "가사를 불러오는 중 오류가 발생했습니다.";
                lyricLines = [];
                currentLyricIndex = -1;
          }
      }

      // --- Parse SRT ---
        function parseSRT(srtData) {
            const lines = srtData.trim().split('\n\n'); // 각 블록으로 분리
            const parsedLyrics = [];

            lines.forEach(line => {
                const parts = line.split('\n');
                if (parts.length >= 3) {
                    const timeString = parts[1];
                    const text = parts.slice(2).join('<br>');

                    // 시간 파싱 (HH:MM:SS,MS)
                    const [startStr, endStr] = timeString.split(' --> ');
                    const startTime = parseTime(startStr);
                    const endTime = parseTime(endStr);

                    parsedLyrics.push({ start: startTime, end: endTime, text });
                }
            });

            return parsedLyrics;
        }

        // --- Parse Time ---
        function parseTime(timeStr) {
            const [hh, mm, ss_ms] = timeStr.split(':');
            const [ss, ms] = ss_ms.split(',');
            return (parseInt(hh, 10) * 3600 + parseInt(mm, 10) * 60 + parseInt(ss, 10)) * 1000 + parseInt(ms, 10);
        }


        // --- Update Lyrics ---
        function updateLyrics(currentTime) {
             const currentTimeMs = currentTime * 1000; // 초를 밀리초로 변환

            // 현재 시간과 일치하는 가사 찾기 (처음부터 찾지 않고, 이전 인덱스부터)
            let nextLyricIndex = -1;
            for (let i = Math.max(0, currentLyricIndex); i < lyricLines.length; i++) {
                if (currentTimeMs >= lyricLines[i].start && currentTimeMs <= lyricLines[i].end) {
                    nextLyricIndex = i;
                    break;
                }
            }

            // 찾은 가사가 이전과 다르면 업데이트
            if (nextLyricIndex !== -1 && nextLyricIndex !== currentLyricIndex) {
                currentLyricIndex = nextLyricIndex;
                lyricsDiv.innerHTML = lyricLines[currentLyricIndex].text;
                highlightCurrentLine();

            } else if (nextLyricIndex === -1 && currentLyricIndex !=-1) {
                // 새로운 가사가 없고, 이전 가사가 있었으면.
                currentLyricIndex = -1;
                lyricsDiv.innerHTML = '';
            }
        }


        function highlightCurrentLine() {
            const lines = lyricsDiv.querySelectorAll('p');
              if (currentLyricIndex >= 0 && currentLyricIndex < lines.length) {
                lines.forEach((line, index) => {
                  if(index === currentLyricIndex){
                      line.classList.add('highlight');
                  } else {
                      line.classList.remove('highlight');
                  }

                });
              }
        }



      // --- Update Progress Bar ---
      function updateProgressBar() {
          if (audioPlayer.duration > 0) {
              const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
              progressBar.style.width = progress + '%';
          }
      }

      // --- Seek to Position ---
      function seekTo(event) {
           const clickX = event.offsetX;
            const barWidth = progressBarContainer.offsetWidth;
            const seekTime = (clickX / barWidth) * audioPlayer.duration;
            audioPlayer.currentTime = seekTime;
      }

      // =========================================================================
      // Event Listeners
      // =========================================================================

      // Timeupdate (for lyrics and progress bar)
        audioPlayer.addEventListener('timeupdate', () => {
            updateLyrics(audioPlayer.currentTime);
            updateProgressBar();
        });

      // Click on Progress Bar
        progressBarContainer.addEventListener('click', seekTo);

      // Play Next Song When Current Song Ends
      audioPlayer.addEventListener('ended', () => {
          currentSongIndex = (currentSongIndex + 1) % musicData.length; // Loop
          loadAndPlaySong(currentSongIndex);
      });

      // =========================================================================
      // Initialization
      // =========================================================================
        loadAndPlaySong(0); // Load first song initially


    </script>
</body>
</html>
