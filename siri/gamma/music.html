<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Siri Music</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background-color: #ecf0f3; overflow-x: hidden; }

    .brand { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; padding: 15px; display: flex; align-items: center; justify-content: space-between; background-color: #ecf0f3; box-shadow: 9px 9px 16px #d1d9e6, -9px -9px 16px #f9f9f9; }
    .brand-title { font-size: 20px; color: #555; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px; position: relative; cursor: pointer; }
    .os-version { font-size: 11px; color: rgba(0, 0, 0, 0.3); position: absolute; bottom: -0.1px; left: 90px; white-space: nowrap; }

    .back-button { position: fixed; top: 65px; left: 10px; background-color: #ecf0f3; border: none; padding: 8px 16px; border-radius: 25px; cursor: pointer; display: none; z-index: 1001; transition: transform 0.3s ease, opacity 0.3s ease; font-size: 14px; color: #555; box-shadow: 5px 5px 9px #d1d9e6, -5px -5px 9px #f9f9f9; }
    .back-button:active { transform: scale(0.95); box-shadow: inset 5px 5px 9px #d1d9e6, inset -5px -5px 9px #f9f9f9; }

    .container { max-width: 1200px; margin: 0 auto; padding: 80px 15px 20px; position: relative; }

    .artists-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; opacity: 1; transition: opacity 0.3s, transform 0.3s; }
    .artists-grid.hidden { opacity: 0; transform: translateY(20px); pointer-events: none; }

    .artist-card { background-color: #ecf0f3; border-radius: 15px; overflow: hidden; box-shadow: 7px 7px 10px #d1d9e6, -7px -7px 10px #f9f9f9; transition: transform 0.2s; cursor: pointer; position: relative; }
    .artist-card:hover { transform: translateY(-3px); box-shadow: 9px 9px 12px #d1d9e6, -9px -9px 12px #f9f9f9; }
    .artist-image { width: 100%; aspect-ratio: 1; object-fit: cover; }
    .artist-name-overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px; background: linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.6)); color: #fff; font-size: 1.4em; font-weight: bold; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); }

    .artist-section { display: none; padding: 0 15px; opacity: 0; transform: translateY(20px); transition: opacity 0.3s, transform 0.3s; }
    .artist-section.active { display: block; opacity: 1; transform: translateY(0); }
    .artist-video-container { position: relative; width: 100%; height: 250px; border-radius: 25px; overflow: hidden; box-shadow: 9px 9px 16px #d1d9e6, -9px -9px 16px #f9f9f9; margin-top: 20px; }
    .artist-video { width: 100%; height: 100%; object-fit: cover; }
    .artist-video-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.4) 90%); pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; padding: 15px; }
    .artist-section .artist-info h2 { color: #555; font-size: 1.6em; margin-bottom: 20px; }

    .albums-grid { display: none; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px; opacity: 0; transform: translateY(20px); transition: opacity 0.3s, transform 0.3s; }
    .albums-grid.active { display: grid; opacity: 1; transform: translateY(0); }
    .album-card { background-color: #ecf0f3; border-radius: 12px; overflow: hidden; box-shadow: 6px 6px 9px #d1d9e6, -6px -6px 9px #f9f9f9; transition: transform 0.2s; cursor: pointer; }
    .album-card:hover { transform: translateY(-3px); box-shadow: 8px 8px 11px #d1d9e6, -8px -8px 11px #f9f9f9; }
    .album-image { width: 100%; aspect-ratio: 1; object-fit: cover; }
    .album-info { padding: 10px 15px; }
    .album-number { color: #777; font-size: 0.8em; margin-bottom: 3px; }

    .tracks-list { display: none; background-color: #ecf0f3; border-radius: 15px; padding: 20px; margin-top: 20px; box-shadow: 7px 7px 10px #d1d9e6, -7px -7px 10px #f9f9f9; opacity: 0; transform: translateY(20px); transition: opacity 0.3s, transform 0.3s; }
    .tracks-list.active { display: block; opacity: 1; transform: translateY(0); }
    .track-item { display: flex; align-items: center; padding: 10px; cursor: pointer; border-radius: 10px; }
    .track-item:hover { background-color: #e2e8ec; }
    .track-number { width: 25px; color: #777; font-size: 0.9em; }
    .track-info { flex-grow: 1; font-size: 0.95em; color: #444; }

    .mini-player { position: fixed; bottom: 15px; right: 15px; background-color: #ecf0f3; border-radius: 12px; padding: 12px; box-shadow: 7px 7px 10px #d1d9e6, -7px -7px 10px #f9f9f9; display: none; align-items: center; gap: 10px; cursor: pointer; z-index: 1000; width: calc(100% - 30px); max-width: 350px; transition: transform 0.3s ease; }
    .mini-player img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }
    .mini-player .track-name { font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.9em; color: #333; }
    .mini-player .artist-name { color: #777; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.8em; }
    .player-controls { display: flex; align-items: center; gap: 5px; }

    .control-button { background: none; border: none; cursor: pointer; padding: 6px; transition: transform 0.2s; color: #555; }
    .mini-player .control-button { font-size: 18px; }
    .full-player .control-button { font-size: 28px; margin: 0 8px; color: #fff; }
    .control-button:hover { transform: scale(1.1); }

    .full-player { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #a8b8fc; display: none; z-index: 2000; padding: 20px; overflow: hidden; }
    .full-player .back-button { position: absolute; top: 20px; left: 20px; display: block; color: #000; box-shadow: 5px 5px 9px #92a3d8, -5px -5px 9px #c0cffd; }
    .full-player-content { display: flex; flex-direction: column; width: 100%; }
    .player-left, .player-right { flex: none; width: 100%; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .player-right { overflow-y: auto; padding-top: 30px; }
    .full-player-album-art { width: 200px; height: 200px; border-radius: 15px; margin-bottom: 15px; }

    .progress-container { width: 95%; max-width: 400px; height: 10px; background-color: #ecf0f3; border-radius: 50px; margin: 20px 0; cursor: pointer; position: relative; box-shadow: inset 5px 5px 10px #d1d9e6, inset -5px -5px 10px #f9f9f9; }
    .progress { height: 100%; background-color: #fff; border-radius: 50px; width: 0; transition: width 0.1s linear; }
    .progress-knob { position: absolute; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; background-color: #ecf0f3; border-radius: 50%; box-shadow: 3px 3px 6px #d1d9e6, -3px -3px 6px #f9f9f9; pointer-events: none; }
    .time-display { display: flex; justify-content: space-between; width: 95%; max-width: 400px; color: #fff; font-size: 12px; }

    .lyrics-container { width: 100%; text-align: center; color: rgba(255, 255, 255, 0.8); overflow-y: auto; max-height: 50vh; padding: 10px; margin-bottom: 20px; }
    .lyrics-container::-webkit-scrollbar { display: none; }
    .lyrics-line { padding: 8px 10px; margin: 5px 0; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.7; border-radius: 10px; cursor: pointer; font-size: 1em; color: #eee; }
    .lyrics-line.active { font-size: 1.2em; font-weight: bold; opacity: 1; transform: scale(1.05); background-color: rgba(255,255,255,0.1); }

    @media (min-width: 768px) {
      .brand { padding: 20px; }
      .brand-title { font-size: 24px; gap: 10px; }
      .os-version { font-size: 12px; left: 110px; }
      .back-button { top: 80px; left: 20px; padding: 10px 20px; font-size: 16px; }
      .container { padding: 100px 20px 20px; }
      .artists-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 30px; }
      .artist-video-container { height: 400px; }
      .albums-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
      .full-player-content { flex-direction: row; }
      .player-left, .player-right { width: 50%; }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    .fade-in { animation: fadeIn 0.3s ease-out both; }
    .fade-out { animation: fadeOut 0.3s ease-in both; }
  </style>
</head>
<body>
  <div class="brand">
    <div class="brand-title" role="button" aria-label="홈으로 이동">Siri Music<span class="os-version">musicOS 1.0</span></div>
  </div>
  <button class="back-button" aria-label="뒤로가기">← 뒤로가기</button>
  <div class="container">
    <div class="artists-grid"></div>
    <div class="artist-section">
      <div class="artist-info"><h2></h2></div>
      <div class="artist-video-container">
        <video class="artist-video" autoplay muted loop><source src="" type="video/mp4"></source></video>
        <div class="artist-video-overlay"></div>
      </div>
    </div>
    <div class="albums-grid"></div>
    <div class="tracks-list"></div>
  </div>
  <div class="mini-player" role="button" aria-label="플레이어 열기">
    <img src="" alt="현재 곡 앨범 아트" class="mini-player-album-art">
    <div class="track-info">
      <div class="track-name"></div>
      <div class="artist-name"></div>
    </div>
    <div class="player-controls">
      <button class="control-button prev-button" aria-label="이전 곡">⏮</button>
      <button class="control-button play-pause-button" aria-label="재생/일시정지">▶</button>
      <button class="control-button next-button" aria-label="다음 곡">⏯</button>
    </div>
  </div>
  <div class="full-player">
    <button class="back-button" aria-label="플레이어 닫기">← 뒤로가기</button>
    <div class="full-player-content">
      <div class="player-left">
        <img src="" alt="앨범 아트" class="full-player-album-art">
        <h2 class="track-name"></h2>
        <p class="artist-name"></p>
        <div class="progress-container" role="slider" aria-label="재생 진행률">
          <div class="progress"></div>
          <div class="progress-knob"></div>
        </div>
        <div class="time-display">
          <span class="current-time">0:00</span>
          <span class="total-time">0:00</span>
        </div>
        <div class="player-controls">
          <button class="control-button prev-button" aria-label="이전 곡">⏮</button>
          <button class="control-button play-pause-button" aria-label="재생/일시정지">▶</button>
          <button class="control-button next-button" aria-label="다음 곡">⏯</button>
        </div>
      </div>
      <div class="player-right">
        <div class="lyrics-container"></div>
      </div>
    </div>
  </div>

  <script>
    const imageCache = new Map();
    const videoCache = new Map();
    const elements = {
      artistsGrid: document.querySelector('.artists-grid'),
      artistSection: document.querySelector('.artist-section'),
      albumsGrid: document.querySelector('.albums-grid'),
      tracksList: document.querySelector('.tracks-list'),
      miniPlayer: document.querySelector('.mini-player'),
      fullPlayer: document.querySelector('.full-player'),
      backButton: document.querySelector('.back-button'),
    };

    const musicLibrary = {
      artists: [
        {
          name: '뉴진스',
          image: 'http://www.applesodam.kro.kr/music/뉴진스/NewJeans.jpg',
          video: 'http://www.applesodam.kro.kr/music/뉴진스/NewJeans.mp4',
          albums: [{
            name: "NewJeans 2nd EP 'Get Up'",
            cover: "http://www.applesodam.kro.kr/music/뉴진스/NewJeans 2nd EP 'Get Up'/NewJeans 2nd EP 'Get Up'.jpg",
            tracks: [
              { number: 1, title: 'New Jeans', audio: "http://www.applesodam.kro.kr/music/뉴진스/NewJeans 2nd EP 'Get Up'/New Jeans.mp3", lyrics: "http://www.applesodam.kro.kr/music/뉴진스/NewJeans 2nd EP 'Get Up'/New Jeans.lrc" },
              { number: 2, title: 'Super Shy', audio: "http://www.applesodam.kro.kr/music/뉴진스/NewJeans 2nd EP 'Get Up'/Super Shy.mp3", lyrics: "http://www.applesodam.kro.kr/music/뉴진스/NewJeans 2nd EP 'Get Up'/Super Shy.lrc" },
            ]
          }]
        },
        {
          name: '아이브',
          image: 'http://www.applesodam.kro.kr/music/아이브/IVE.jpg',
          video: 'http://www.applesodam.kro.kr/music/아이브/IVE.mp4',
          albums: [{
            name: "IVE EMPATHY - EP",
            cover: "http://www.applesodam.kro.kr/music/아이브/IVE EMPATHY - EP/IVE EMPATHY - EP.jpg",
            tracks: [
              { number: 1, title: 'REBEL HEART', audio: "http://www.applesodam.kro.kr/music/아이브/IVE EMPATHY - EP/REBEL HEART.mp3", lyrics: "http://www.applesodam.kro.kr/music/아이브/IVE EMPATHY - EP/REBEL HEART.lrc" },
              { number: 2, title: 'FLU', audio: "http://www.applesodam.kro.kr/music/아이브/IVE EMPATHY - EP/FLU.mp3", lyrics: "http://www.applesodam.kro.kr/music/아이브/IVE EMPATHY - EP/FLU.lrc" },
            ]
          }]
        }
      ]
    };

    let currentArtist = null, currentAlbum = null, currentTrack = null, audio = new Audio(), isPlaying = false, currentLyrics = [], isDragging = false;
    let historyStack = ['artists'];

    async function getCachedImage(url) {
      if (!imageCache.has(url)) {
        const img = new Image();
        img.src = url;
        await new Promise((resolve, reject) => {
          img.onload = resolve;
          img.onerror = reject;
        });
        imageCache.set(url, img);
      }
      return imageCache.get(url);
    }

    async function getCachedVideo(url) {
      if (!videoCache.has(url)) {
        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error('비디오 로드 실패');
          const blob = await response.blob();
          videoCache.set(url, URL.createObjectURL(blob));
        } catch (error) {
          console.error(error);
          return url; // 오류 시 원본 URL 사용
        }
      }
      return videoCache.get(url);
    }

    function initializeMusicPlayer() {
      loadArtists();
      setupEventListeners();
      audio.volume = 0.5;
    }

    async function loadArtists() {
      elements.artistsGrid.innerHTML = '<div class="loading">로딩 중...</div>';
      elements.artistsGrid.classList.remove('hidden');
      elements.artistSection.classList.remove('active');
      elements.albumsGrid.classList.remove('active');
      elements.tracksList.classList.remove('active');
      elements.backButton.style.display = 'none';

      elements.artistsGrid.innerHTML = '';
      for (const artist of musicLibrary.artists) {
        const card = await createArtistCard(artist);
        elements.artistsGrid.appendChild(card);
      }
    }

    async function createArtistCard(artist) {
      const card = document.createElement('div');
      card.className = 'artist-card';
      const img = await getCachedImage(artist.image);
      card.innerHTML = `<img src="${artist.image}" class="artist-image" alt="${artist.name}">
                        <div class="artist-name-overlay">${artist.name}</div>`;
      card.addEventListener('click', () => showArtist(artist));
      return card;
    }

    async function showArtist(artist) {
      currentArtist = artist;
      elements.artistsGrid.classList.add('hidden');
      elements.artistSection.classList.add('active');
      elements.albumsGrid.classList.add('active');
      elements.backButton.style.display = 'block';

      const video = elements.artistSection.querySelector('.artist-video');
      video.src = await getCachedVideo(artist.video);
      elements.artistSection.querySelector('.artist-info h2').textContent = artist.name;
      await loadAlbums(artist);

      if (historyStack[historyStack.length - 1] !== 'artist') historyStack.push('artist');
    }

    async function loadAlbums(artist) {
      elements.albumsGrid.innerHTML = '';
      for (let i = 0; i < artist.albums.length; i++) {
        const card = await createAlbumCard(artist.albums[i], i + 1);
        elements.albumsGrid.appendChild(card);
      }
    }

    async function createAlbumCard(album, number) {
      const card = document.createElement('div');
      card.className = 'album-card';
      await getCachedImage(album.cover);
      card.innerHTML = `<img src="${album.cover}" class="album-image" alt="${album.name}">
                        <div class="album-info"><div class="album-number">#${number}</div><h3>${album.name}</h3></div>`;
      card.addEventListener('click', () => showAlbumTracks(album));
      return card;
    }

    function showAlbumTracks(album) {
      currentAlbum = album;
      elements.albumsGrid.classList.remove('active');
      elements.tracksList.classList.add('active');
      elements.tracksList.innerHTML = '';
      album.tracks.forEach(track => elements.tracksList.appendChild(createTrackItem(track)));
      if (historyStack[historyStack.length - 1] !== 'album') historyStack.push('album');
    }

    function createTrackItem(track) {
      const item = document.createElement('div');
      item.className = 'track-item';
      item.innerHTML = `<span class="track-number">${track.number}</span><div class="track-info">${track.title}</div>`;
      item.addEventListener('click', () => playTrack(track));
      return item;
    }

    async function playTrack(track) {
      currentTrack = track;
      audio.src = track.audio;
      try {
        await audio.play();
        isPlaying = true;
      } catch (error) {
        console.error('재생 오류:', error);
        isPlaying = false;
      }

      const img = await getCachedImage(currentAlbum.cover);
      const colorThief = new ColorThief();
      const colors = colorThief.getPalette(img, 2);
      const gradientColors = colors.map(c => `rgb(${c[0]}, ${c[1]}, ${c[2]})`);
      elements.fullPlayer.style.background = `linear-gradient(to bottom right, ${gradientColors[0]}, ${gradientColors[1]})`;

      updateMiniPlayer();
      updateFullPlayer();
      await loadAndDisplayLyrics(track.lyrics);
    }

    function updateMiniPlayer() {
      elements.miniPlayer.style.display = 'flex';
      elements.miniPlayer.querySelector('img').src = currentAlbum.cover;
      elements.miniPlayer.querySelector('.track-name').textContent = currentTrack.title;
      elements.miniPlayer.querySelector('.artist-name').textContent = currentArtist.name;
      document.querySelectorAll('.play-pause-button').forEach(btn => btn.textContent = isPlaying ? '⏸' : '▶');
    }

    function updateFullPlayer() {
      if (elements.fullPlayer.style.display === 'flex') {
        elements.fullPlayer.querySelector('.track-name').textContent = currentTrack.title;
        elements.fullPlayer.querySelector('.artist-name').textContent = currentArtist.name;
        elements.fullPlayer.querySelector('.full-player-album-art').src = currentAlbum.cover;
      }
    }

    async function loadAndDisplayLyrics(url) {
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error('가사 로드 실패');
        const text = await response.text();
        currentLyrics = parseLRC(text);
        displayLyrics(currentLyrics);
      } catch (error) {
        console.error(error);
        elements.fullPlayer.querySelector('.lyrics-container').innerHTML = '<div class="lyrics-line">가사를 불러올 수 없습니다.</div>';
      }
    }

    function parseLRC(content) {
      const lines = content.trim().split('\n');
      const lyrics = [];
      const timeRegex = /\[(\d+):(\d+(\.\d+)?)\]/;
      lines.forEach(line => {
        const match = line.match(timeRegex);
        if (match) {
          const time = parseInt(match[1]) * 60 + parseFloat(match[2]);
          const text = line.replace(timeRegex, '').trim();
          if (text) lyrics.push({ time, text });
        }
      });
      return lyrics.sort((a, b) => a.time - b.time);
    }

    function displayLyrics(lyrics) {
      const container = elements.fullPlayer.querySelector('.lyrics-container');
      container.innerHTML = '';
      lyrics.forEach(line => {
        const div = document.createElement('div');
        div.className = 'lyrics-line';
        div.dataset.time = line.time;
        div.textContent = line.text;
        div.addEventListener('click', () => audio.currentTime = parseFloat(line.time));
        container.appendChild(div);
      });
      updateLyrics();
    }

    function setupEventListeners() {
      elements.backButton.addEventListener('click', handleBack);
      document.querySelector('.brand-title').addEventListener('click', goToHome);
      elements.miniPlayer.addEventListener('click', showFullPlayer);
      document.querySelectorAll('.player-controls').forEach(c => {
        c.addEventListener('click', e => e.stopPropagation());
        c.querySelector('.play-pause-button').addEventListener('click', togglePlayPause);
        c.querySelector('.prev-button').addEventListener('click', playPreviousTrack);
        c.querySelector('.next-button').addEventListener('click', playNextTrack);
      });
      elements.fullPlayer.querySelector('.back-button').addEventListener('click', hideFullPlayer);
      const progress = elements.fullPlayer.querySelector('.progress-container');
      progress.addEventListener('mousedown', startDragging);
      progress.addEventListener('touchstart', startDragging, { passive: false });
      document.addEventListener('mousemove', drag);
      document.addEventListener('touchmove', drag, { passive: false });
      document.addEventListener('mouseup', stopDragging);
      document.addEventListener('touchend', stopDragging);
      audio.addEventListener('timeupdate', updateProgress);
      audio.addEventListener('ended', playNextTrack);
    }

    function startDragging(e) {
      e.preventDefault();
      isDragging = true;
      seekAudio(e);
    }

    function drag(e) {
      if (isDragging) seekAudio(e);
    }

    function stopDragging() {
      isDragging = false;
    }

    function seekAudio(e) {
      const rect = elements.fullPlayer.querySelector('.progress-container').getBoundingClientRect();
      const x = e.touches ? e.touches[0].clientX : e.clientX;
      let percent = (x - rect.left) / rect.width;
      percent = Math.max(0, Math.min(1, percent));
      audio.currentTime = percent * audio.duration;
    }

    function updateProgress() {
      const percentage = (audio.currentTime / audio.duration) * 100 || 0;
      elements.fullPlayer.querySelector('.progress').style.width = `${percentage}%`;
      elements.fullPlayer.querySelector('.progress-knob').style.left = `${percentage}%`;
      elements.fullPlayer.querySelector('.current-time').textContent = formatTime(audio.currentTime);
      elements.fullPlayer.querySelector('.total-time').textContent = formatTime(audio.duration);
      updateLyrics();
    }

    function formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      const m = Math.floor(seconds / 60);
      const s = Math.floor(seconds % 60).toString().padStart(2, '0');
      return `${m}:${s}`;
    }

    function updateLyrics() {
      if (!currentLyrics.length) return;
      const currentTime = audio.currentTime;
      const lyric = currentLyrics.find(l => l.time > currentTime) || currentLyrics[currentLyrics.length - 1];
      const index = currentLyrics.indexOf(lyric) - 1;
      const lines = elements.fullPlayer.querySelectorAll('.lyrics-line');
      lines.forEach(l => l.classList.remove('active'));
      if (index >= 0) lines[index].classList.add('active');
    }

    function handleBack() {
      historyStack.pop();
      const view = historyStack[historyStack.length - 1];
      if (elements.tracksList.classList.contains('active')) {
        elements.tracksList.classList.remove('active');
        elements.albumsGrid.classList.add('active');
      } else if (elements.albumsGrid.classList.contains('active')) {
        elements.albumsGrid.classList.remove('active');
        elements.artistSection.classList.remove('active');
        elements.artistsGrid.classList.remove('hidden');
        elements.backButton.style.display = 'none';
      } else if (elements.fullPlayer.style.display === 'flex') {
        hideFullPlayer();
      }
    }

    function goToHome() {
      elements.artistSection.classList.remove('active');
      elements.albumsGrid.classList.remove('active');
      elements.tracksList.classList.remove('active');
      elements.fullPlayer.style.display = 'none';
      elements.artistsGrid.classList.remove('hidden');
      elements.backButton.style.display = 'none';
      historyStack = ['artists'];
    }

    function showFullPlayer() {
      elements.fullPlayer.style.display = 'flex';
      elements.fullPlayer.classList.add('fade-in');
      updateFullPlayer();
      elements.miniPlayer.style.display = 'none';
      if (historyStack[historyStack.length - 1] !== 'full-player') historyStack.push('full-player');
    }

    function hideFullPlayer() {
      elements.fullPlayer.classList.add('fade-out');
      setTimeout(() => {
        elements.fullPlayer.style.display = 'none';
        elements.fullPlayer.classList.remove('fade-out');
        elements.miniPlayer.style.display = 'flex';
      }, 300);
      if (historyStack[historyStack.length - 1] === 'full-player') historyStack.pop();
    }

    function togglePlayPause() {
      isPlaying = !audio.paused;
      audio.paused ? audio.play() : audio.pause();
      document.querySelectorAll('.play-pause-button').forEach(btn => btn.textContent = isPlaying ? '⏸' : '▶');
    }

    function playPreviousTrack() {
      const i = currentAlbum.tracks.indexOf(currentTrack);
      playTrack(currentAlbum.tracks[i > 0 ? i - 1 : currentAlbum.tracks.length - 1]);
    }

    function playNextTrack() {
      const i = currentAlbum.tracks.indexOf(currentTrack);
      playTrack(currentAlbum.tracks[i < currentAlbum.tracks.length - 1 ? i + 1 : 0]);
    }

    document.addEventListener('DOMContentLoaded', initializeMusicPlayer);
  </script>
</body>
</html>
