<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시험지 생성기</title>
    <!-- MathJax CDN: LaTeX 렌더링 -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- jsPDF CDN: PDF 출력 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 20px;
            width: 90%;
            max-width: 1200px;
        }

        .input-section, .preview-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            flex: 1;
        }

        .input-section h2, .preview-section h2 {
            color: #333;
            text-align: center;
        }

        textarea, input[type="text"], input[type="file"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        button {
            background: rgba(0, 123, 255, 0.8);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: rgba(0, 123, 255, 1);
        }

        .preview-section {
            overflow-y: auto;
            max-height: 80vh;
        }

        .exam-paper {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .exam-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .question {
            margin-bottom: 20px;
        }

        .question img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
        }

        .choices {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <h2>문제 입력</h2>
            <input type="text" id="subject" placeholder="과목명 (예: 수학, 국어, 영어)">
            <textarea id="question" rows="4" placeholder="문제를 입력하세요 (LaTeX 지원, 예: 2^2)"></textarea>
            <input type="text" id="choices" placeholder="선택지 (쉼표로 구분, 예: 1, 2, 3, 4, 5)">
            <input type="file" id="image" accept="image/*" onchange="previewImage(event)">
            <button onclick="addQuestion()">문제 추가</button>
            <button onclick="generatePDF()">PDF로 저장</button>
        </div>
        <div class="preview-section">
            <h2>시험지 미리보기</h2>
            <div id="examPaper" class="exam-paper">
                <div class="exam-header">
                    <h1 id="examSubject">2024학년도 모의고사</h1>
                    <p>제 2 교시</p>
                </div>
                <div id="questions"></div>
            </div>
        </div>
    </div>

    <script>
        let questionCount = 0;
        let images = {};

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    images[questionCount] = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function addQuestion() {
            const subject = document.getElementById('subject').value || '수학';
            const questionText = document.getElementById('question').value;
            const choicesText = document.getElementById('choices').value;
            const questionsDiv = document.getElementById('questions');
            const examSubject = document.getElementById('examSubject');

            if (!questionText) {
                alert('문제를 입력하세요.');
                return;
            }

            questionCount++;
            examSubject.textContent = `${subject} 모의고사`;

            const questionDiv = document.createElement('div');
            questionDiv.className = 'question';
            questionDiv.innerHTML = `
                <p><strong>${questionCount}.</strong> ${questionText}</p>
                ${images[questionCount - 1] ? `<img src="${images[questionCount - 1]}" alt="문제 이미지">` : ''}
                ${choicesText ? '<div class="choices"><p>' + choicesText.split(',').map((choice, index) => `(${index + 1}) ${choice.trim()}`).join(' ') + '</p></div>' : ''}
            `;

            questionsDiv.appendChild(questionDiv);

            // MathJax로 LaTeX 렌더링
            MathJax.typesetPromise();

            // 입력 초기화
            document.getElementById('question').value = '';
            document.getElementById('choices').value = '';
            document.getElementById('image').value = '';
            delete images[questionCount - 1];
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const examPaper = document.getElementById('examPaper');

            doc.html(examPaper, {
                callback: function (doc) {
                    doc.save('시험지.pdf');
                },
                x: 10,
                y: 10,
                width: 190,
                windowWidth: 650
            });
        }
    </script>
</body>
</html>
